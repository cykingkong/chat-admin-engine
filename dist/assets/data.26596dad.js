import{_ as e}from"./index.a302575e.js";/* empty css               *//* empty css                *//* empty css                *//* empty css               *//* empty css                *//* empty css                *//* empty css                *//* empty css              *//* empty css               *//* empty css              *//* empty css               *//* empty css              *//* empty css              *//* empty css               *//* empty css                *//* empty css                */import{d as a,f as t,r as l,b_ as o,aH as n,D as r,E as i,H as d,aK as s,aJ as u,aM as c,aL as m,u as p,aO as f,aP as y,bk as g,be as h,bu as v,bv as w,c2 as b,cl as _,c9 as x,ce as C,bl as k,by as I,bG as Y,bq as D,c3 as S,bz as V,c8 as K,co as j,c5 as M,bM as z,b9 as O,ba as A,aF as H,cd as T}from"./arco.0e1801a1.js";import{u as P}from"./loading.4d3258a0.js";import{x as N,y as B,z as R,A as U,d as E,e as G}from"./plant.a1deaa45.js";import{e as q,h as F}from"./enum.5f967a9b.js";import{g as J}from"./settings.c4a72107.js";import{c as L}from"./event.471a062e.js";import{E as $,a as W}from"./export-list.0e079d35.js";import{f as Q}from"./vue.6618b53d.js";import{s as X}from"./sph.fffc74fa.js";import"./chart.b4fe0742.js";/* empty css                */const Z=e=>(O("data-v-672f0ad9"),e=e(),A(),e),ee={class:"container"},ae={class:"upai_content"},te=Z((()=>d("div",{class:"pageTitle"}," 计划包数据 ",-1))),le=Z((()=>d("div",{class:"labelText"},"名称搜索：",-1))),oe=Z((()=>d("div",{class:"labelText"},"所属部门：",-1))),ne=Z((()=>d("div",{class:"labelText"},"加热状态：",-1))),re=Z((()=>d("div",{class:"labelText"},"创建时间：",-1))),ie=e(a({__name:"data",setup(e,{expose:a}){const O=t(),A=[{label:"当日",value:()=>[o().startOf("date").format("YYYY-MM-DD HH:mm:ss"),o().endOf("date").format("YYYY-MM-DD HH:mm:ss")]},{label:"昨日",value:()=>[o().add(-1,"day").startOf("date").format("YYYY-MM-DD HH:mm:ss"),o().add(-1,"day").endOf("date").format("YYYY-MM-DD HH:mm:ss")]},{label:"近一周",value:()=>[o().add(-1,"week").startOf("date").format("YYYY-MM-DD HH:mm:ss"),o().add(-1,"day").endOf("date").format("YYYY-MM-DD HH:mm:ss")]},{label:"近一月",value:()=>[o().add(-1,"month").startOf("date").format("YYYY-MM-DD HH:mm:ss"),o().add(-1,"day").endOf("date").format("YYYY-MM-DD HH:mm:ss")]},{label:"本月",value:()=>[o().startOf("month").startOf("date").format("YYYY-MM-DD HH:mm:ss"),o().endOf("date").format("YYYY-MM-DD HH:mm:ss")]}],Z=["","#7bc616","#ff5722"],{loading:ie,setLoading:de}=P(!0),se=t(!1),ue=t("新建计划包"),ce=t({name:null,type:1}),me=t(),pe={current:1,pageIndex:1,pageSize:30,defaultPageSize:30,pageSizeOptions:[10,30,50,100],total:0,defaultCurrent:1,page:1},fe=t(!1),ye=t([]),ge=t([]),he=l({...pe}),ve=t([{colKey:"packageName",title:"计划包名称",fixed:"left",align:"left",width:220},{colKey:"memberDepName",title:"所属部门",align:"center",width:120},{colKey:"estimatedWecoinAmount",title:"投放总金额",align:"center",width:150,sortType:"all",sorter:!0},{colKey:"plantCount",title:"总计划条数",align:"center",width:150,sortType:"all",sorter:!0},{colKey:"plantHotCount",title:"加热计划条数",align:"center",width:150,sortType:"all",sorter:!0},{colKey:"hotStatus",title:"加热状态",align:"center",width:100},{colKey:"process",title:"消耗比例",align:"center",width:170},{colKey:"cost",title:"消耗金额",align:"center",width:120,sortType:"all",sorter:!0},{colKey:"productOrderCount",title:"订单数",align:"center",width:100,sortType:"all",sorter:!0},{colKey:"productPlaceorderGmv",title:"营业额",align:"center",width:100,sortType:"all",sorter:!0},{colKey:"roi",title:"ROI",align:"center",width:100},{colKey:"lr",title:"利润",align:"center",width:100},{colKey:"airCost",title:"空耗值",align:"center",width:120,sortType:"all",sorter:!0},{colKey:"qan_cost",title:"千展成本",width:"100",align:"center"},{colKey:"click_rate",title:"点击率",width:"100",align:"center"},{colKey:"click_cost",title:"点击成本",width:"100",align:"center"},{colKey:"zh_cost",title:"转化成本",width:"100",align:"center"},{colKey:"zh_rate",title:"转化率",width:"100",align:"center"},{colKey:"productClickCountPv",title:"商品点击",align:"center",width:120,sortType:"all",sorter:!0},{colKey:"exposureCount",title:"浏览",align:"center",width:100,sortType:"all",sorter:!0},{colKey:"likeCount",title:"点赞",align:"center",width:100,sortType:"all",sorter:!0},{colKey:"favCount",title:"评论",align:"center",width:100,sortType:"all",sorter:!0},{colKey:"totalIndemnifyVoucherAmount",title:"补贴金额",width:"120",align:"center"},{colKey:"indemnifyVoucherAmountRoi",title:"补贴ROI",width:"120",align:"center"},{colKey:"updatedAt",title:"更新时间",align:"center",width:120},{colKey:"op",title:"操作",fixed:"right",align:"center",width:150}]);ye.value=ve.value.map((e=>{if("row-select"!==e.colKey)return e.colKey}));const we=()=>({startDate:o().add(-1,"month").format("YYYY-MM-DD").toString(),endDate:o().format("YYYY-MM-DD").toString(),pageIndex:1,pageSize:30,hotStatus:-1,taskStatus:-1}),be=e=>isNaN(e)||0===Number(e)?0:Number(e).toFixed(2),_e=e=>isNaN(e)||0===Number(e)||e===1/0?"-":Number(e).toFixed(2),xe=t(we()),Ce=t([]);t(0);const ke=t([]),Ie=t([]),Ye=t([]);function De(e,a){for(let t=0;t<e.length;t++){const l=e[t];if(l.memberDepId===a)return l.memberDepName;if(l.children&&l.children.length>0){const e=De(l.children,a);if(e)return e}}return null}const Se=()=>{delete xe.value.memberDepId},Ve=async e=>{de(!0);try{const{data:a}=await N(e);a.grid&&a.grid.forEach(((e,a)=>{e.key=String(a+1),e.click_cost=_e(e.cost/e.productClickCountPv),e.memberDepName=e.memberDepId?De(ge.value,e.memberDepId):"-",e.click_rate="-"===_e(e.productClickCountPv/e.exposureCount*100)?"-":`${_e(e.productClickCountPv/e.exposureCount*100)}%`,e.qan_cost=_e(e.cost/e.exposureCount*1e3),e.zh_cost=_e(e.cost/e.productOrderCount),e.zh_rate="-"===_e(e.productOrderCount/e.productClickCountPv*100)?"-":`${_e(e.productOrderCount/e.productClickCountPv*100)}%`,e.shutdownSwitch=0!==e.shutdownStatus,e.indemnifyVoucherAmountRoi=e.cost-e.totalIndemnifyVoucherAmount/100<=0?"-":_e(e.productPlaceorderGmv/(e.cost-e.totalIndemnifyVoucherAmount/100));o(e.indemnifyTs).isAfter(o());e.totalIndemnifyVoucherAmount>0&&(e.totalIndemnifyVoucherAmount/=100)})),Ce.value=a.grid||[],he.current=e.pageIndex,he.pageIndex=e.pageIndex,he.total=a.total}catch(a){}finally{de(!1)}},Ke=e=>{pe.pageIndex=e.current,pe.current=e.current,pe.pageSize=e.pageSize,he.pageIndex=e.current,he.current=e.current,he.pageSize=e.pageSize,Ve({...xe.value,...pe})},je=e=>{xe.value.startDate=e[0],xe.value.endDate=e[1]},Me=()=>{Ke({current:1,pageSize:he.pageSize})},ze=async(e,a)=>{2===e?(ue.value="修改计划包",ce.value.packageId=a.packageId,ce.value.name=a.packageName):(ue.value="新增计划包",ce.value.name=null),ce.value.type=e,se.value=!0},Oe=async e=>{var a;await(null==(a=me.value)?void 0:a.validate())?e(!1):(1===ce.value.type?(await R({name:ce.value.name}),g.success({content:"添加计划包成功",duration:5e3}),await Me()):(await U({packageId:ce.value.packageId,name:ce.value.name}),g.success({content:"修改计划包成功",duration:5e3}),await Me()),ce.value.name=null,window.setTimeout((()=>{e()}),300))},Ae=Q(),He=()=>{var e;null==(e=O.value)||e.showModel()},Te=async()=>{const e={...xe.value};e.excel=!0;const{data:a,code:t,message:l}=await W(e);200===t&&g.success("数据报表生成中，请前往报表列表查看")},Pe=t([]);localStorage.getItem("package-disPlayColumns")?Pe.value=JSON.parse(localStorage.getItem("package-disPlayColumns")):ve.value.forEach((e=>{Pe.value.push(e.colKey)}));const Ne=async e=>{localStorage.setItem("package-disPlayColumns",JSON.stringify(e))},Be=async e=>{e?(xe.value.orderKey=e.sortBy,xe.value.orderSort=e.descending?"DESC":"ASC"):xe.value.orderSort=null,Me()},Re=t([]);Re.value=[o().add(-1,"month"),o()];return(async()=>{(async()=>{const{data:e}=await X({pageIndex:1,pageSize:200,sphType:1});ke.value=e.grid})(),(async()=>{const{data:e}=await E({pageIndex:1,pageSize:200});Ie.value=e.grid})(),(async()=>{const{data:e}=await G({pageIndex:1,pageSize:200});Ye.value=e.grid})(),(async e=>{const{data:a}=await J(e);return a.grid?ge.value=L(a.grid):ge.value=[],new Promise((e=>{e(!0)}))})({pageIndex:1,pageSize:150}).then((e=>{Ve({...xe.value})}))})(),a({fetchData:Ve}),(e,a)=>{const t=n("Breadcrumb"),l=v,P=w,N=b,R=_,U=T,E=x,G=C,J=k,L=I,W=Y,Q=D,X=S,de=V,pe=K,_e=n("icon-plus"),ke=n("icon-unordered-list"),Ie=n("icon-down"),Ye=n("t-dropdown-item"),De=n("t-divider"),Ve=n("t-dropdown-menu"),Ue=n("t-dropdown"),Ee=n("icon-settings"),Ge=j,qe=M,Fe=z,Je=n("t-table"),Le=h;return r(),i("div",ee,[d("div",ae,[s(t,{items:["投流管理","计划包"]}),te,s(X,null,{default:u((()=>[s(pe,{class:"general-card-upai",style:{width:"100%"}},{default:u((()=>[s(X,null,{default:u((()=>[s(N,{flex:1},{default:u((()=>[s(de,{model:xe.value,"auto-label-width":"","label-align":"left"},{default:u((()=>[s(X,{gutter:16},{default:u((()=>[s(N,{span:8},{default:u((()=>[s(P,{field:"name"},{label:u((()=>[le])),default:u((()=>[s(l,{modelValue:xe.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>xe.value.name=e),placeholder:"请输入计划包名称","allow-clear":"",onPressEnter:Me},null,8,["modelValue"])])),_:1})])),_:1}),s(N,{span:8},{default:u((()=>[s(P,{field:"sphId"},{label:u((()=>[oe])),default:u((()=>[s(R,{modelValue:xe.value.memberDepId,"onUpdate:modelValue":a[1]||(a[1]=e=>xe.value.memberDepId=e),options:ge.value,"check-strictly":"","allow-clear":"","field-names":{value:"memberDepId",label:"memberDepName"},placeholder:"请选择所属部门",onClear:Se},null,8,["modelValue","options"])])),_:1})])),_:1}),s(N,{span:8},{default:u((()=>[s(P,{field:"hotStatus"},{label:u((()=>[ne])),default:u((()=>[s(E,{modelValue:xe.value.hotStatus,"onUpdate:modelValue":a[2]||(a[2]=e=>xe.value.hotStatus=e),placeholder:"请选择加热状态"},{default:u((()=>[(r(!0),i(c,null,m(p(q)(p(F)),((e,a)=>(r(),H(U,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),s(N,{span:10},{default:u((()=>[s(P,{field:"createdTime"},{label:u((()=>[re])),default:u((()=>[s(G,{modelValue:Re.value,"onUpdate:modelValue":a[3]||(a[3]=e=>Re.value=e),"show-time":"","default-value":[p(o)().add(-1,"month"),p(o)()],style:{width:"100%"},shortcuts:A,"shortcuts-position":"left",onChange:je},null,8,["modelValue","default-value"])])),_:1})])),_:1}),s(N,{span:8}),s(N,{span:6}),s(N,{span:8},{default:u((()=>[s(P,{field:"number","hide-label":!0},{default:u((()=>[s(Q,{size:18},{default:u((()=>[s(J,{type:"primary",class:"searchBtn",onClick:Me},{default:u((()=>[f(" 筛选 ")])),_:1}),s(J,{type:"outline",class:"refreshBtn",onClick:a[4]||(a[4]=e=>Me())},{default:u((()=>[f(" 刷新 ")])),_:1}),s(W,{type:"primary"},{default:u((()=>[s(L,{href:"javascript:void(0)",onClick:a[5]||(a[5]=e=>(xe.value=we(),void(Re.value=[o().add(-1,"month"),o()])))},{default:u((()=>[f("重置筛选条件")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})])),_:1})])),_:1}),s(pe,{class:"general-card-upai",style:{width:"100%","padding-bottom":"28px"}},{default:u((()=>[s(X,{justify:"space-between"},{default:u((()=>[s(N,{flex:"250px"},{default:u((()=>[s(Q,{size:18,style:{"margin-bottom":"10px"}},{default:u((()=>[s(J,{type:"primary",onClick:a[6]||(a[6]=e=>ze(1))},{icon:u((()=>[s(_e)])),default:u((()=>[f(" 创建计划包 ")])),_:1}),s(Ue,{"min-column-width":88},{default:u((()=>[s(J,{type:"primary",status:"success",class:"searchBtn"},{icon:u((()=>[s(ke)])),default:u((()=>[s(Q,null,{default:u((()=>[f(" 导出 "),s(Ie)])),_:1})])),_:1}),s(Ve,null,{default:u((()=>[s(Ye,{value:1,divider:"",onClick:a[7]||(a[7]=e=>{h.info({title:"提示",content:"是否导出选中数据？",simple:!1,hideCancel:!1,cancelText:"取消",async onOk(){Te()}})})},{default:u((()=>[f(" 导出 ")])),_:1}),s(De),s(Ye,{value:2,onClick:He},{default:u((()=>[f(" 报表列表 ")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),s(N,{flex:"60px"},{default:u((()=>[s(Q,{size:18,style:{"margin-bottom":"10px"}},{default:u((()=>[s(J,{type:"primary",onClick:a[8]||(a[8]=e=>fe.value=!0)},{icon:u((()=>[s(Ee)])),default:u((()=>[f(" 列表配置 ")])),_:1})])),_:1})])),_:1})])),_:1}),s(Je,{columnControllerVisible:fe.value,"onUpdate:columnControllerVisible":a[9]||(a[9]=e=>fe.value=e),"row-key":"plantId",data:Ce.value,columns:ve.value,loading:p(ie),"header-affixed-top":!0,"max-height":1e3,"column-controller":{placement:"top-right",fields:ye.value,dialogProps:{preventScrollThrough:!0},hideTriggerButton:!0},pagination:he,bordered:!1,"table-layout":"fixed","default-display-columns":Pe.value,"on-display-columns-change":Ne,onPageChange:Ke,onSortChange:Be},{process:u((({row:e})=>[s(Ge,{percent:Number(be(e.cost/e.estimatedWecoinAmount)),style:{width:"50%"}},null,8,["percent"])])),roi:u((({row:e})=>[f(y(be(e.productPlaceorderGmv/e.cost)),1)])),lr:u((({row:e})=>[f(y(be(e.productPlaceorderGmv-e.cost)),1)])),hotStatus:u((({row:e})=>[s(qe,{color:Z[e.hotStatus]},{default:u((()=>[f(y(p(F)[e.hotStatus]),1)])),_:2},1032,["color"])])),totalIndemnifyVoucherAmount:u((({row:e})=>[s(Q,null,{default:u((()=>[d("span",null,y(e.totalIndemnifyVoucherAmount?`¥${e.totalIndemnifyVoucherAmount}`:"-"),1)])),_:2},1024)])),totalIndemnifyVoucherIntoAmount:u((({row:e})=>[f(y(e.totalIndemnifyVoucherIntoAmount?"¥"+e.totalIndemnifyVoucherIntoAmount/100:"-"),1)])),indemnifyVoucherAmountRoi:u((({row:e})=>[f(y(e.indemnifyVoucherAmountRoi||"-"),1)])),op:u((({row:e})=>[s(J,{type:"text",size:"small",onClick:a=>(e=>{Ae.push({name:"plantData",query:{packageId:e.packageId,packageCreaedAt:o(e.createdAt).unix()}})})(e)},{default:u((()=>[f(" 查看计划 ")])),_:2},1032,["onClick"]),s(J,{type:"text",size:"small",onClick:a=>ze(2,e)},{default:u((()=>[f(" 修改 ")])),_:2},1032,["onClick"]),s(Fe,{content:"确认是否删除此计划","ok-text":"确认",onOk:a=>(async e=>{const{data:a}=await B({packageId:e.packageId});a&&(g.success({content:"删除计划包成功",duration:5e3}),await Me())})(e)},{default:u((()=>[s(J,{type:"text",size:"small"},{default:u((()=>[f(" 删除 ")])),_:1})])),_:2},1032,["onOk"])])),_:1},8,["columnControllerVisible","data","columns","loading","column-controller","pagination","default-display-columns"])])),_:1})]),s($,{ref_key:"exportList",ref:O},null,512),s(Le,{visible:se.value,"onUpdate:visible":a[11]||(a[11]=e=>se.value=e),title:ue.value,onCancel:a[12]||(a[12]=e=>se.value=!1),onBeforeOk:Oe},{default:u((()=>[s(de,{ref_key:"formGpRef",ref:me,model:ce.value,"label-col-props":{span:6},"wrapper-col-props":{span:18}},{default:u((()=>[s(P,{field:"name",label:"计划包名称",rules:[{required:!0,message:"请填写计划包名称"}]},{default:u((()=>[s(l,{modelValue:ce.value.name,"onUpdate:modelValue":a[10]||(a[10]=e=>ce.value.name=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])])}}}),[["__scopeId","data-v-672f0ad9"]]);export{ie as default};
