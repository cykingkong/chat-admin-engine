import{y as e,_ as a}from"./index.a302575e.js";/* empty css                *//* empty css              *//* empty css               *//* empty css               */import{g as l,b as t,a as u,c as d,d as n,i as r,u as o}from"./listMethods.d3977bf1.js";/* empty css              *//* empty css                *//* empty css               *//* empty css                *//* empty css                *//* empty css                *//* empty css                */import{d as s,f as i,c as m,w as c,r as v,aH as p,ch as h,cp as f,c8 as g,cf as b,bu as y,c9 as k,bx as I,cC as _,bz as x,bN as w,D as R,E as N,aK as V,aJ as j,bk as D,c3 as S,be as C,aM as z,aL as U,aO as A,H as q,aP as T,u as K,b_ as E,aF as M,aG as P,bq as Y,ci as L,bl as O,c2 as B,bP as F,bv as H,F as $,b9 as G,ba as J,cd as Q}from"./arco.0e1801a1.js";import{u as W}from"./loading.4d3258a0.js";import{g as X}from"./event.471a062e.js";import{_ as Z}from"./lodash.64978348.js";import"./chart.b4fe0742.js";import"./vue.6618b53d.js";const ee=e=>(G("data-v-f95b5300"),e=e(),J(),e),ae={class:"content"},le={style:{"white-space":"nowrap"}},te={class:"status"},ue=ee((()=>q("span",null,"状态：",-1))),de={key:0,"data-status-open":""},ne={key:1,"data-status-close":""},re={class:"createTime"},oe=ee((()=>q("span",null,"创建时间：",-1))),se={class:"createTime"},ie=ee((()=>q("span",null,"备注：",-1))),me=a(s({name:"SearchTable",setup(a){const s=i(0),G=i(1),J=i({roleId:void 0,roleName:"",createdAt:"",memberRoleRemark:"",menuId:[]}),ee=i([]),me=i([]),ce=i([]),ve=i([]),pe=i(!1),he=i(!1),fe=i(!1),ge=i(!1),be=i(!1),ye=i("添加角色"),ke=i({roleName:"",roleData:0,memberRoleRemark:"",useStatus:1,type:1}),Ie=m((()=>ce.value));c(Ie,((e,a)=>{const l=X(ve.value);e.length===l.length?pe.value=!0:e.length<l.length&&e.length>0?fe.value=!0:(pe.value=!1,fe.value=!1)}));c((()=>J.value.menuId),((e,a)=>{if(e){const a=X(ve.value);e.length===a.length?he.value=!0:e.length<a.length&&e.length>0?ge.value=!0:(he.value=!1,ge.value=!1)}}));const _e=e=>{if(e){const e=X(ve.value);ce.value=e}else ce.value=[]},xe=e=>{if(he.value=e,e){const e=X(ve.value);J.value.menuId=e}else J.value.menuId=[]},{loading:we,setLoading:Re}=W(!1),Ne=i([{value:0,label:"所有"},{value:1,label:"本部门及以下数据权限 "},{value:2,label:"本部门数据权限"},{value:3,label:"仅本人数据权限"}]),Ve=[{colKey:"memberNickname",title:"用户名称",width:"200",align:"center"},{colKey:"memberAccount",title:"手机号",width:"200",align:"center"},{colKey:"memberDepName",title:"所属部门",width:"200",align:"center"}],je=(e,a="children")=>{for(let l=0;l<e.length;l++){const t=e[l];t&&t[a]&&(0===t[a].length?delete t[a]:je(t[a],a))}return e},De=()=>{l().then((e=>{e.grid&&(me.value=e.grid,s.value=e.grid[0].roleId,J.value=e.grid[0],t(e.grid[0].roleId).then((e=>{})),Ce(e.grid[0].roleId))}))},Se=e=>{G.value=e},Ce=e=>{u({roleId:e}).then((e=>{J.value.menuId=X(e.grid),function(){const e=X(ve.value);J.value.menuId.length===e.length?he.value=!0:J.value.menuId.length<e.length&&J.value.menuId.length>0?ge.value=!0:(he.value=!1,ge.value=!1)}()})),d({roleId:e}).then((e=>{e.grid?ee.value=e.grid.map((e=>({memberNickname:e.memberNickname||"-",memberAccount:e.memberAccount||"-",memberDepName:e.memberDepName||"-"}))):ee.value=[],J.value.memberTotal=e.total,qe.total=e.total}))};De();const ze=e=>{},Ue=e=>{},Ae={current:1,pageIndex:1,pageSize:30,defaultPageSize:30,pageSizeOptions:[10,30,50,100],total:0,defaultCurrent:1,page:1},qe=v({...Ae});(async a=>{Re(!0);try{const{data:l}=await e(a);if(l.grid){const e=je(l.grid).map((e=>({menuName:e.menuName,menuId:e.menuId,children:e.children||[],icon:e.menuIcon||""})));ve.value=e.map((e=>{if(e.children.length>0&&32===e.menuId){const a=e.children.filter((e=>34!==e.menuId));e.children=a}return e}))}}catch(l){}finally{Re(!1)}})({...Ae});const Te=e=>{Ae.pageIndex=e.current,Ae.current=e.current,Ae.pageSize=e.pageSize,qe.pageIndex=e.current,qe.current=e.current,qe.pageSize=e.pageSize},Ke=()=>{be.value=!1},Ee=i(),Me=i(),Pe=async()=>{var e;if(await(null==(e=Me.value)?void 0:e.validate()),0===J.value.menuId.length)return void D.info("请为角色分配权限！");const a={roleId:J.value.roleId,roleName:J.value.roleName,roleData:J.value.roleData,useStatus:J.value.useStatus,memberRoleRemark:J.value.memberRoleRemark};o(a).then((e=>{const a={roleId:J.value.roleId,menuIdArr:J.value.menuId};J.value.menuId.forEach((e=>{ve.value.forEach((a=>{Z.find(a.children,["menuId",e])&&a.children.length>0&&!J.value.menuId.includes(Z.find(a.children,["menuId",e]).parentId)&&J.value.menuId.push(Z.find(a.children,["menuId",e]).parentId)}))})),r(a).then((e=>{var a;200===e.code&&(D.success("编辑角色成功"),a=J.value.roleId,t(a).then((e=>{e.menuId=X(e.grid),delete e.grid,J.value=e})))}))}))},Ye=async e=>{var a;if(await(null==(a=Ee.value)?void 0:a.validate()))e(!1);else{if(1===ke.value.type){if(0===ce.value.length)return void D.info("请为角色分配权限！");n(ke.value).then((e=>{if(200===e.code){const a={roleId:e.data.roleId,menuIdArr:[]};a.menuIdArr=ce.value,r(a).then((e=>{200===e.code&&(D.success("添加角色成功"),be.value=!1,De())}))}}))}window.setTimeout((()=>{e()}),300)}};return(e,a)=>{const l=p("Breadcrumb"),t=p("icon-user"),u=Y,d=h,n=L,r=f,o=p("icon-plus"),i=O,m=g,c=B,v=b,D=p("t-table"),W=F,X=y,Ie=H,Re=Q,je=k,De=I,Ae=_,Le=x,Oe=S,Be=w,Fe=C;return R(),N("div",ae,[V(l,{items:["系统管理","角色管理"]}),V(Oe,{gutter:24},{default:j((()=>[V(c,{span:5},{default:j((()=>[V(m,{style:{width:"100%","min-height":"537px"},class:"general-card",title:"系统角色"},{default:j((()=>[V(r,{style:{height:"71vh",overflow:"auto"}},{default:j((()=>[V(n,{modelValue:s.value,"onUpdate:modelValue":a[0]||(a[0]=e=>s.value=e),style:{width:"100%"},direction:"vertical",cols:1,"row-gap":24,onChange:a[1]||(a[1]=e=>{return a=e,J.value=Z.find(me.value,["roleId",a]),void Ce(J.value.roleId);var a})},{default:j((()=>[(R(!0),N(z,null,U(me.value,((e,a)=>(R(),M(d,{key:a,value:e.roleId},{radio:j((({checked:a})=>[V(u,{class:$(["li",{checkLi:a}]),size:12},{default:j((()=>[V(t),q("span",le,T(e.roleName),1)])),_:2},1032,["class"])])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1}),V(i,{type:"text",onClick:a[2]||(a[2]=e=>{return a=1,ke.value.type=a,ke.value={roleName:"",roleData:0,memberRoleRemark:"",useStatus:1,type:1},ce.value=[],ye.value=1===a?"添加角色":"编辑角色",void(be.value=!0);var a})},{default:j((()=>[V(u,null,{default:j((()=>[V(o),A("添加角色 ")])),_:1})])),_:1})])),_:1})])),_:1}),V(c,{span:19},{default:j((()=>[V(m,{style:{width:"100%"},class:"general-card",title:`${J.value.roleName}${J.value.memberTotal?"("+J.value.memberTotal+")":"-"}`||"-"},{default:j((()=>[V(u,{size:20},{default:j((()=>[q("div",te,[ue,q("span",null,[V(u,null,{default:j((()=>[1===J.value.useStatus?(R(),N("span",de)):(R(),N("span",ne)),A(" "+T(1===J.value.useStatus?"已启用":"已禁用"),1)])),_:1})])]),q("div",re,[oe,q("span",null,T(K(E)(J.value.createdAt).format("YYYY-MM-DD")),1)]),q("div",se,[ie,q("span",null,T(J.value.memberRoleRemark||"-"),1)])])),_:1}),V(v),V(Be,{"active-key":G.value,"lazy-load":"",style:{height:"68vh"},onChange:Se},{default:j((()=>[(R(),M(W,{key:1,title:"角色成员"},{default:j((()=>[V(D,{"drag-sort":"col",data:ee.value,"max-height":1e3,columns:Ve,loading:K(we),pagination:qe,bordered:!1,onPageChange:Te},null,8,["data","loading","pagination"])])),_:1})),(R(),M(W,{key:2,title:"角色权限"},{default:j((()=>[V(r,{style:{height:"337px",overflow:"auto"}},{default:j((()=>[V(Le,{ref_key:"formRefEdit",ref:Me,style:{width:"500px"},model:J.value,"label-col-props":{span:6},"wrapper-col-props":{span:18}},{default:j((()=>[V(Ie,{field:"roleName",label:"角色名称",rules:[{required:!0,message:"请填写角色名称"}]},{default:j((()=>[V(X,{modelValue:J.value.roleName,"onUpdate:modelValue":a[3]||(a[3]=e=>J.value.roleName=e),style:{width:"200px"},placeholder:"请填写角色名称"},null,8,["modelValue"])])),_:1}),V(Ie,{field:"memberRoleRemark",label:"角色备注"},{default:j((()=>[V(X,{modelValue:J.value.memberRoleRemark,"onUpdate:modelValue":a[4]||(a[4]=e=>J.value.memberRoleRemark=e),style:{"{\n                          width":"200px"},placeholder:"请填写角色备注"},null,8,["modelValue"])])),_:1}),V(Ie,{field:"roleData",label:"数据权限",rules:[{required:!0,message:"请选择数据权限"}]},{default:j((()=>[V(je,{modelValue:J.value.roleData,"onUpdate:modelValue":a[5]||(a[5]=e=>J.value.roleData=e),"allow-clear":"",placeholder:"请选择数据权限"},{default:j((()=>[(R(!0),N(z,null,U(Ne.value,((e,a)=>(R(),M(Re,{key:a,value:e.value},{default:j((()=>[A(T(e.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1}),V(Ie,{field:"",label:"权限管理",rules:[{required:!0,message:"请选择菜单"}]},{default:j((()=>[V(u,{direction:"vertical"},{default:j((()=>[V(De,{"model-value":he.value,indeterminate:ge.value,onChange:xe},{default:j((()=>[A("全选")])),_:1},8,["model-value","indeterminate"]),V(Ae,{"checked-keys":J.value.menuId,"onUpdate:checkedKeys":a[6]||(a[6]=e=>J.value.menuId=e),checkable:!0,"field-names":{key:"menuId",title:"menuName",children:"children",icon:"menuIcon"},"only-check-leaf":!0,"check-strictly":!1,"default-expand-all":!1,"checked-strategy":"all",data:ve.value,onCheck:Ue},null,8,["checked-keys","data"])])),_:1})])),_:1})])),_:1},8,["model"])])),_:1}),V(Oe,{justify:"center"},{default:j((()=>[V(c,{flex:"60px"},{default:j((()=>[V(i,{type:"primary",onClick:Pe},{default:j((()=>[A("编辑")])),_:1})])),_:1})])),_:1})])),_:1}))])),_:1},8,["active-key"])])),_:1},8,["title"])])),_:1})])),_:1}),V(Fe,{visible:be.value,"onUpdate:visible":a[11]||(a[11]=e=>be.value=e),title:ye.value,width:1===ke.value.type?"40%":"70%",onCancel:Ke,onBeforeOk:Ye},{default:j((()=>[V(Le,{ref_key:"formRef",ref:Ee,model:ke.value,"label-col-props":{span:6},"wrapper-col-props":{span:18}},{default:j((()=>[V(Ie,{field:"roleName",label:"角色名称",rules:[{required:!0,message:"请填写角色名称"}]},{default:j((()=>[V(X,{modelValue:ke.value.roleName,"onUpdate:modelValue":a[7]||(a[7]=e=>ke.value.roleName=e),placeholder:"请填写角色名称"},null,8,["modelValue"])])),_:1}),V(Ie,{field:"memberRoleRemark",label:"角色备注"},{default:j((()=>[V(X,{modelValue:ke.value.memberRoleRemark,"onUpdate:modelValue":a[8]||(a[8]=e=>ke.value.memberRoleRemark=e),placeholder:"请填写角色备注"},null,8,["modelValue"])])),_:1}),3!=ke.value.type?(R(),M(Ie,{key:0,field:"roleData",label:"数据权限",rules:[{required:!0,message:"请选择数据权限"}]},{default:j((()=>[V(je,{modelValue:ke.value.roleData,"onUpdate:modelValue":a[9]||(a[9]=e=>ke.value.roleData=e),"allow-clear":"",placeholder:"请选择数据权限"},{default:j((()=>[(R(!0),N(z,null,U(Ne.value,((e,a)=>(R(),M(Re,{key:a,value:e.value},{default:j((()=>[A(T(e.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1})):P("",!0),V(Ie,{field:"",label:"权限管理",rules:[{required:!0,message:"请选择菜单"}]},{default:j((()=>[V(u,{direction:"vertical"},{default:j((()=>[V(De,{"model-value":pe.value,indeterminate:fe.value,onChange:_e},{default:j((()=>[A("全选")])),_:1},8,["model-value","indeterminate"]),V(Ae,{"checked-keys":ce.value,"onUpdate:checkedKeys":a[10]||(a[10]=e=>ce.value=e),checkable:!0,"field-names":{key:"menuId",title:"menuName",children:"children",icon:"menuIcon"},"only-check-leaf":!0,"check-strictly":!1,"default-expand-all":!1,"checked-strategy":"all",data:ve.value,onCheck:ze},null,8,["checked-keys","data"])])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title","width"])])}}}),[["__scopeId","data-v-f95b5300"]]);export{me as default};
