import{v as e,y as a,_ as l}from"./index.a302575e.js";/* empty css               */import{g as t,a as d}from"./listMethods.d3977bf1.js";/* empty css                *//* empty css                *//* empty css              *//* empty css                *//* empty css               *//* empty css                *//* empty css                *//* empty css               *//* empty css               *//* empty css                *//* empty css                *//* empty css              *//* empty css               *//* empty css              *//* empty css               *//* empty css                */import{d as r,f as u,r as o,aH as m,bu as s,cl as n,c9 as i,by as c,bz as p,cf as v,bM as b,c6 as f,c7 as g,c8 as y,cC as _,D as h,E as x,aK as I,aJ as k,bk as w,be as V,aM as U,aL as j,aO as S,u as D,aP as N,b_ as z,H as C,aF as A,aG as R,a$ as P,b0 as q,bv as B,c2 as M,bl as H,bG as O,bq as Y,c3 as E,c4 as G,b9 as K,ba as L,cd as T}from"./arco.0e1801a1.js";import{u as F}from"./loading.4d3258a0.js";import{g as J,b as $,i as Q,u as W,d as X}from"./settings.c4a72107.js";import{c as Z,g as ee}from"./event.471a062e.js";import{z as ae}from"./enum.5f967a9b.js";import{_ as le}from"./lodash.64978348.js";import"./chart.b4fe0742.js";import"./vue.6618b53d.js";const te=e=>(K("data-v-6ba2fe64"),e=e(),L(),e),de={class:"container"},re={class:"pagination",style:{display:"flex","justify-content":"space-between","margin-top":"15px"}},ue=te((()=>C("div",null,null,-1))),oe=te((()=>C("div",{class:"treeMark"},null,-1))),me=l(r({name:"SearchTable",setup(l){const r=u([{value:0,label:"禁用"},{value:1,label:"启用"}]),K=u([]),L=u([]),te=()=>{delete ge.value.memberDepId},{loading:me,setLoading:se}=F(!0);e.exports.useI18n();const ne=u([]),ie=u("请先选择用户角色");t().then((e=>{e.grid&&(ne.value=e.grid)}));const ce=u([{value:0,label:"所有"},{value:1,label:"本部门及以下数据权限 "},{value:2,label:"本部门数据权限"},{value:3,label:"仅本人数据权限"}]),pe=e=>{if(e){const a=le.find(ne.value,["roleId",e]).roleData;ie.value=ce.value[a].label,d({roleId:e}).then((e=>{K.value=ee(e.grid)}))}else ie.value="请先选择用户角色",K.value=[]},ve=u([]),be=async e=>{se(!0);try{const{data:a}=await J(e);ve.value=Z(a.grid)}catch(a){}finally{se(!1)}};be({pageIndex:1,pageSize:20});const fe=u([]),ge=u({}),ye={current:1,pageIndex:1,pageSize:20},_e=o({...ye});(async e=>{try{const{data:l}=await a(e);if(l.grid){const e=Z(l.grid).map((e=>({menuName:e.menuName,menuId:e.menuId,children:e.children||[],icon:e.menuIcon||""})));L.value=e.map((e=>{if(e.children.length>0&&32===e.menuId){const a=e.children.filter((e=>34!==e.menuId));e.children=a}return e}))}}catch(l){}})({...ye});const he=async e=>{se(!0);try{const{data:a}=await $(e);fe.value=a.grid,_e.current=e.pageIndex,_e.pageIndex=e.pageIndex,_e.total=a.total}catch(a){}finally{se(!1)}},xe=e=>{ye.pageIndex=e,ye.current=e,he({...ye,...ge.value})},Ie=()=>{xe(1),be({pageIndex:1,pageSize:20})};he({...ye,...ge.value});const ke=e=>{ye.pageSize=e,_e.pageSize=e,Ie()},we=u(!1),Ve=u("新增子账号"),Ue=u({memberAccount:"",memberUserRemark:"",memberNickname:"",memberPassword:"",memberDepId:void 0,memberUserId:void 0,roleId:void 0,memberStatus:1,dataRole:void 0,type:1}),je=(e,a)=>{2===e?(Ve.value="编辑子账号信息",Ue.value.memberAccount=a.memberAccount,Ue.value.memberNickname=a.memberNickname,Ue.value.memberUserRemark=a.memberUserRemark,Ue.value.memberDepId=a.memberDepId,Ue.value.dataRole=a.dataRole,Ue.value.roleId=a.roleId?a.roleId:void 0,ie.value=ce.value[a.roleData].label,K.value=[],a.roleId&&d({roleId:a.roleId||0}).then((e=>{K.value=ee(e.grid)})),Ue.value.memberStatus=a.memberStatus,Ue.value.memberUserId=a.memberUserId,Ue.value.memberPassword="",Ue.value.type=2):3===e?(Ve.value="修改子账号密码",Ue.value.sysUserId=a.userId,Ue.value.userPassword="",Ue.value.type=3):(Ve.value="新增子账号",Ue.value={memberAccount:"",memberUserRemark:"",memberNickname:"",memberPassword:"",memberDepId:void 0,memberUserId:void 0,roleId:void 0,memberStatus:1,dataRole:void 0,type:1},ie.value="请先选择用户角色",K.value=[]),we.value=!0},Se=u(),De=async e=>{var a;await(null==(a=Se.value)?void 0:a.validate())?e(!1):(1===Ue.value.type?(await Q(Ue.value),w.success({content:"添加成功",duration:5e3}),Ie()):3===Ue.value.type||(await W(Ue.value),w.success({content:"修改成功",duration:5e3}),Ie()),window.setTimeout((()=>{e()}),300))},Ne=()=>{we.value=!1};return(e,a)=>{const l=m("Breadcrumb"),t=s,d=B,u=M,o=n,F=T,J=i,$=H,Q=c,W=O,Z=Y,ee=E,le=p,se=v,ce=m("icon-plus"),be=m("icon-refresh"),ye=G,he=b,ze=f,Ce=g,Ae=y,Re=_,Pe=V;return h(),x("div",de,[I(l,{items:["系统管理","子账号管理"]}),I(Ae,{class:"general-card",title:"子账号管理"},{default:k((()=>[I(ee,null,{default:k((()=>[I(u,{flex:1},{default:k((()=>[I(le,{model:ge.value,"auto-label-width":"","label-align":"left"},{default:k((()=>[I(ee,{gutter:16},{default:k((()=>[I(u,{span:8},{default:k((()=>[I(d,{field:"memberNickname",label:"账户昵称","label-col-flex":"60px"},{default:k((()=>[I(t,{modelValue:ge.value.memberNickname,"onUpdate:modelValue":a[0]||(a[0]=e=>ge.value.memberNickname=e),placeholder:"请输入账户昵称","allow-clear":"",onPressEnter:Ie},null,8,["modelValue"])])),_:1})])),_:1}),I(u,{span:8},{default:k((()=>[I(d,{field:"memberAccount",label:"登录账号","label-col-flex":"60px"},{default:k((()=>[I(t,{modelValue:ge.value.memberAccount,"onUpdate:modelValue":a[1]||(a[1]=e=>ge.value.memberAccount=e),placeholder:"请输入登录账号","allow-clear":"",onPressEnter:Ie},null,8,["modelValue"])])),_:1})])),_:1}),I(u,{span:8},{default:k((()=>[I(d,{field:"memberDepId",label:"所属部门","label-col-flex":"60px"},{default:k((()=>[I(o,{modelValue:ge.value.memberDepId,"onUpdate:modelValue":a[2]||(a[2]=e=>ge.value.memberDepId=e),options:ve.value,"check-strictly":"","allow-clear":"","field-names":{value:"memberDepId",label:"memberDepName"},placeholder:"请选择所属部门",onClear:te},null,8,["modelValue","options"])])),_:1})])),_:1}),I(u,{span:8},{default:k((()=>[I(d,{field:"memberStatus",label:"状态","label-col-flex":"30px"},{default:k((()=>[I(J,{modelValue:ge.value.memberStatus,"onUpdate:modelValue":a[3]||(a[3]=e=>ge.value.memberStatus=e),"allow-clear":"",placeholder:"请选择状态"},{default:k((()=>[(h(!0),x(U,null,j(r.value,((e,a)=>(h(),A(F,{key:a,value:e.value},{default:k((()=>[S(N(e.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),I(u,{span:8},{default:k((()=>[I(d,{field:"roleId",label:"角色","label-col-flex":"30px"},{default:k((()=>[I(J,{modelValue:ge.value.roleId,"onUpdate:modelValue":a[4]||(a[4]=e=>ge.value.roleId=e),"allow-clear":"",placeholder:"请选择角色"},{default:k((()=>[(h(!0),x(U,null,j(ne.value,((e,a)=>(h(),A(F,{key:a,value:e.roleId},{default:k((()=>[S(N(e.roleName),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),I(u,{span:8}),I(u,{span:8},{default:k((()=>[I(d,{field:"number","hide-label":!0},{default:k((()=>[I(Z,{size:18},{default:k((()=>[I($,{type:"primary",class:"searchBtn",onClick:Ie},{default:k((()=>[S(" 筛选 ")])),_:1}),I($,{type:"outline",class:"refreshBtn",onClick:a[5]||(a[5]=e=>Ie())},{default:k((()=>[S(" 刷新 ")])),_:1}),I(W,{type:"primary"},{default:k((()=>[I(Q,{href:"javascript:void(0)",onClick:a[6]||(a[6]=e=>{ge.value={}})},{default:k((()=>[S("重置筛选条件")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1}),I(se,{style:{"margin-top":"0"}}),I(ee,{style:{"margin-bottom":"16px"}},{default:k((()=>[I(u,{span:16},{default:k((()=>[I(Z,null,{default:k((()=>[I($,{type:"primary",onClick:a[7]||(a[7]=e=>je(1))},{icon:k((()=>[I(ce)])),default:k((()=>[S(" 新建子账号 ")])),_:1})])),_:1})])),_:1}),I(u,{span:8,style:{"text-align":"right"}},{default:k((()=>[I($,{type:"primary",onClick:a[8]||(a[8]=e=>Ie())},{icon:k((()=>[I(be)])),default:k((()=>[S(" 刷新 ")])),_:1})])),_:1})])),_:1}),I(ze,{"row-key":"id",loading:D(me),pagination:!1,data:fe.value,bordered:!1,onPageChange:xe},{columns:k((()=>[I(ye,{title:"账户昵称",align:"center"},{cell:k((({record:e})=>[S(N(e.memberNickname||0)+" ",1)])),_:1}),I(ye,{title:"登录账号",align:"center"},{cell:k((({record:e})=>[S(N(e.memberAccount||"-"),1)])),_:1}),I(ye,{title:"用户角色",align:"center"},{cell:k((({record:e})=>[S(N(e.roleName||"-"),1)])),_:1}),I(ye,{title:"所属部门",align:"center"},{cell:k((({record:e})=>[S(N(e.member_dep_name||"-"),1)])),_:1}),I(ye,{title:"账号状态",align:"center"},{cell:k((({record:e})=>[S(N(D(ae)[e.memberStatus]||0),1)])),_:1}),I(ye,{title:"创建时间",align:"center"},{cell:k((({record:e})=>[S(N(e.createdAt?D(z)(e.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"),1)])),_:1}),I(ye,{title:"备注",align:"center"},{cell:k((({record:e})=>[S(N(e.memberUserRemark||"-"),1)])),_:1}),I(ye,{title:"操作","data-index":"operations",align:"center"},{cell:k((({record:e})=>[I(Z,null,{default:k((()=>[I($,{type:"text",size:"small",onClick:a=>je(2,e)},{default:k((()=>[S(" 编辑 ")])),_:2},1032,["onClick"]),I(he,{content:"确认是否删除此子账号","ok-text":"确认",onOk:a=>(async e=>{await X({memberUserId:e.memberUserId}),w.success({content:"成功删除子账号",duration:5e3}),Ie()})(e)},{default:k((()=>[I($,{type:"text",status:"danger",size:"small"},{default:k((()=>[S(" 删除 ")])),_:1})])),_:2},1032,["onOk"])])),_:2},1024)])),_:1})])),_:1},8,["loading","data"]),C("div",re,[ue,C("div",null,[I(Ce,{current:_e.pageIndex,"onUpdate:current":a[9]||(a[9]=e=>_e.pageIndex=e),"page-size":_e.pageSize,"onUpdate:pageSize":a[10]||(a[10]=e=>_e.pageSize=e),total:_e.total,"show-total":!0,"show-page-size":!0,"page-size-options":[10,20,50,100,200],onChange:xe,onPageSizeChange:ke},null,8,["current","page-size","total"])])])])),_:1}),I(Pe,{visible:we.value,"onUpdate:visible":a[19]||(a[19]=e=>we.value=e),title:Ve.value,width:"900px",onCancel:Ne,onBeforeOk:De},{default:k((()=>[I(le,{ref_key:"formRef",ref:Se,style:{margin:"0 auto",width:"800px"},model:Ue.value,"label-col-props":{span:6},"wrapper-col-props":{span:18}},{default:k((()=>[I(Z,{style:{width:"100%"},align:"start"},{default:k((()=>[I(Ae,{class:"general-card",style:{width:"400px"},"header-style":{paddingBottom:"0"},"body-style":{padding:"17px 20px 21px 20px"},title:"用户信息"},{default:k((()=>[3!=Ue.value.type?(h(),A(d,{key:0,field:"memberNickname",label:"用户昵称",rules:[{required:!0,message:"请填写用户昵称"}]},{default:k((()=>[I(t,{modelValue:Ue.value.memberNickname,"onUpdate:modelValue":a[11]||(a[11]=e=>Ue.value.memberNickname=e),"allow-clear":"",placeholder:"请填写用户昵称"},null,8,["modelValue"])])),_:1})):R("",!0),3!=Ue.value.type?(h(),A(d,{key:1,field:"memberAccount",label:"登录手机号",rules:[{required:!0,message:"请填写登录手机号"}]},{default:k((()=>[I(t,{modelValue:Ue.value.memberAccount,"onUpdate:modelValue":a[12]||(a[12]=e=>Ue.value.memberAccount=e),"allow-clear":"",placeholder:"请填写登录手机号"},null,8,["modelValue"])])),_:1})):R("",!0),3!=Ue.value.type?(h(),A(d,{key:2,field:"memberPassword",label:"登录密码",rules:[{required:1==Ue.value.type,message:"请填写登录密码"}]},{default:k((()=>[I(t,{modelValue:Ue.value.memberPassword,"onUpdate:modelValue":a[13]||(a[13]=e=>Ue.value.memberPassword=e),"allow-clear":"",placeholder:"请填写登录密码"},null,8,["modelValue"])])),_:1},8,["rules"])):R("",!0),3!=Ue.value.type?(h(),A(d,{key:3,field:"memberDepId",label:"所属部门",rules:[{required:!0,message:"请选择所属部门"}]},{default:k((()=>[I(o,{modelValue:Ue.value.memberDepId,"onUpdate:modelValue":a[14]||(a[14]=e=>Ue.value.memberDepId=e),options:ve.value,"check-strictly":"","allow-clear":"","field-names":{value:"memberDepId",label:"memberDepName"},placeholder:"请选择所属部门"},null,8,["modelValue","options"])])),_:1})):R("",!0),3!=Ue.value.type?(h(),A(d,{key:4,field:"memberStatus",label:"状态",rules:[{required:!0,message:"请选择状态"}]},{default:k((()=>[I(J,{modelValue:Ue.value.memberStatus,"onUpdate:modelValue":a[15]||(a[15]=e=>Ue.value.memberStatus=e),"allow-clear":"",placeholder:"请选择状态"},{default:k((()=>[(h(!0),x(U,null,j(r.value,((e,a)=>(h(),A(F,{key:a,value:e.value},{default:k((()=>[S(N(e.label),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1})):R("",!0),I(d,{field:"memberUserRemark",label:"备注"},{default:k((()=>[I(t,{modelValue:Ue.value.memberUserRemark,"onUpdate:modelValue":a[16]||(a[16]=e=>Ue.value.memberUserRemark=e),placeholder:"请填写备注"},null,8,["modelValue"])])),_:1})])),_:1}),I(Ae,{class:"general-card",style:{width:"400px"},"header-style":{paddingBottom:"0"},"body-style":{padding:"17px 20px 21px 20px"},title:"权限配置"},{default:k((()=>[I(d,{field:"roleId",label:"用户角色",rules:[{required:!0,message:"请选择数据权限"}]},{default:k((()=>[I(J,{modelValue:Ue.value.roleId,"onUpdate:modelValue":a[17]||(a[17]=e=>Ue.value.roleId=e),"allow-clear":"",placeholder:"请选择用户角色",onChange:pe},{default:k((()=>[(h(!0),x(U,null,j(ne.value,((e,a)=>(h(),A(F,{key:a,value:e.roleId},{default:k((()=>[S(N(e.roleName),1)])),_:2},1032,["value"])))),128))])),_:1},8,["modelValue"])])),_:1}),I(d,{label:"数据权限"},{default:k((()=>[I(W,null,{default:k((()=>[S(N(ie.value),1)])),_:1})])),_:1}),I(d,{label:"菜单权限",style:{position:"relative"}},{default:k((()=>[oe,S(" "+N(0===K.value.length?"请先选择用户角色":"")+" ",1),P(I(Re,{"checked-keys":K.value,"onUpdate:checkedKeys":a[18]||(a[18]=e=>K.value=e),checkable:!0,"field-names":{key:"menuId",title:"menuName",children:"children",icon:"menuIcon"},"only-check-leaf":!0,"check-strictly":!1,"default-expand-all":!0,"checked-strategy":"all",data:L.value},null,8,["checked-keys","data"]),[[q,K.value.length>0]])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"])])}}}),[["__scopeId","data-v-6ba2fe64"]]);export{me as default};
