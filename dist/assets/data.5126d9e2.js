import{_ as e}from"./index.a302575e.js";/* empty css               *//* empty css                *//* empty css                *//* empty css               *//* empty css                *//* empty css                *//* empty css                *//* empty css              *//* empty css               *//* empty css              *//* empty css               *//* empty css              *//* empty css              *//* empty css               *//* empty css                *//* empty css                */import{d as a,f as t,r as l,b_ as o,aH as r,D as n,E as s,H as i,aK as d,aJ as u,aM as c,aL as p,u as m,aO as f,aP as g,bk as v,bu as y,bv as h,c2 as b,cl as x,c9 as w,ce as _,bl as C,by as Y,bG as k,bq as D,c3 as S,bz as I,c8 as j,co as K,c5 as M,bM as z,be as H,b9 as O,ba as T,aF as V,cd as N}from"./arco.0e1801a1.js";import{u as P}from"./loading.4d3258a0.js";import{a as U,b as A,c as B,d as E}from"./live.0a587604.js";import{d as q,e as G}from"./plant.a1deaa45.js";import{e as F,h as J}from"./enum.5f967a9b.js";import{g as L}from"./settings.c4a72107.js";import{c as R}from"./event.471a062e.js";import{f as W}from"./vue.6618b53d.js";import{s as $}from"./sph.fffc74fa.js";import"./xlsx.0c218054.js";import{E as Q}from"./export-list.0e079d35.js";import"./chart.b4fe0742.js";/* empty css                */const X=e=>(O("data-v-4c63067c"),e=e(),T(),e),Z={class:"container"},ee={class:"upai_content"},ae=X((()=>i("div",{class:"pageTitle"}," 计划包数据 ",-1))),te=X((()=>i("div",{class:"labelText"},"名称搜索：",-1))),le=X((()=>i("div",{class:"labelText"},"所属部门：",-1))),oe=X((()=>i("div",{class:"labelText"},"加热状态：",-1))),re=X((()=>i("div",{class:"labelText"},"创建时间：",-1))),ne=e(a({__name:"data",setup(e,{expose:a}){const O=t(),T=[{label:"当日",value:()=>[o().startOf("date").format("YYYY-MM-DD HH:mm:ss"),o().endOf("date").format("YYYY-MM-DD HH:mm:ss")]},{label:"昨日",value:()=>[o().add(-1,"day").startOf("date").format("YYYY-MM-DD HH:mm:ss"),o().add(-1,"day").endOf("date").format("YYYY-MM-DD HH:mm:ss")]},{label:"近一周",value:()=>[o().add(-1,"week").startOf("date").format("YYYY-MM-DD HH:mm:ss"),o().add(-1,"day").endOf("date").format("YYYY-MM-DD HH:mm:ss")]},{label:"近一月",value:()=>[o().add(-1,"month").startOf("date").format("YYYY-MM-DD HH:mm:ss"),o().add(-1,"day").endOf("date").format("YYYY-MM-DD HH:mm:ss")]},{label:"本月",value:()=>[o().startOf("month").startOf("date").format("YYYY-MM-DD HH:mm:ss"),o().endOf("date").format("YYYY-MM-DD HH:mm:ss")]}],X=["","#7bc616","#ff5722"],{loading:ne,setLoading:se}=P(!0),ie=t(!1),de=t("新建计划包"),ue=t({name:null,type:1}),ce=t(),pe={current:1,pageIndex:1,pageSize:30,defaultPageSize:30,pageSizeOptions:[10,30,50,100],total:0,defaultCurrent:1,page:1},me=t(!1),fe=t([]),ge=t([]),ve=l({...pe}),ye=t([{colKey:"packageName",title:"计划包名称",fixed:"left",align:"left",width:220},{colKey:"memberDepName",title:"所属部门",align:"center",width:120},{colKey:"estimatedWecoinAmount",title:"投放总金额",align:"center",width:150,sortType:"all",sorter:!0},{colKey:"plantCount",title:"总计划条数",align:"center",width:150,sortType:"all",sorter:!0},{colKey:"plantHotCount",title:"加热计划条数",align:"center",width:150,sortType:"all",sorter:!0},{colKey:"hotStatus",title:"加热状态",align:"center",width:100},{colKey:"process",title:"消耗比例",align:"center",width:170},{colKey:"cost",title:"消耗金额",align:"center",width:120,sortType:"all",sorter:!0},{colKey:"productOrderCount",title:"订单数",align:"center",width:100,sortType:"all",sorter:!0},{colKey:"productPlaceorderGmv",title:"营业额",align:"center",width:100,sortType:"all",sorter:!0},{colKey:"roi",title:"ROI",align:"center",width:100},{colKey:"lr",title:"利润",align:"center",width:100},{colKey:"airCost",title:"空耗值",align:"center",width:120,sortType:"all",sorter:!0},{colKey:"qan_cost",title:"千展成本",width:"100",align:"center"},{colKey:"click_rate",title:"点击率",width:"100",align:"center"},{colKey:"click_cost",title:"点击成本",width:"100",align:"center"},{colKey:"zh_cost",title:"转化成本",width:"100",align:"center"},{colKey:"zh_rate",title:"转化率",width:"100",align:"center"},{colKey:"productClickCountUv",title:"商品点击",align:"center",width:120,sortType:"all",sorter:!0},{colKey:"exposureCount",title:"浏览",align:"center",width:100,sortType:"all",sorter:!0},{colKey:"likeCount",title:"点赞",align:"center",width:100,sortType:"all",sorter:!0},{colKey:"commentCount",title:"评论",align:"center",width:100,sortType:"all",sorter:!0},{colKey:"updatedAt",title:"更新时间",align:"center",width:120},{colKey:"op",title:"操作",fixed:"right",align:"center",width:150}]);fe.value=ye.value.map((e=>{if("row-select"!==e.colKey)return e.colKey}));const he=()=>({startDate:o().add(-1,"month").format("YYYY-MM-DD").toString(),endDate:o().format("YYYY-MM-DD").toString(),pageIndex:1,pageSize:30,hotStatus:-1,taskStatus:-1}),be=e=>isNaN(e)||0===Number(e)?0:Number(e).toFixed(2),xe=e=>isNaN(e)||0===Number(e)||e===1/0?"-":Number(e).toFixed(2),we=t(he()),_e=t([]);t(0);const Ce=t([]),Ye=t([]),ke=t([]);function De(e,a){for(let t=0;t<e.length;t++){const l=e[t];if(l.memberDepId===a)return l.memberDepName;if(l.children&&l.children.length>0){const e=De(l.children,a);if(e)return e}}return null}const Se=()=>{delete we.value.memberDepId},Ie=async e=>{se(!0);try{const{data:a}=await U(e);a.grid&&a.grid.forEach(((e,a)=>{e.key=String(a+1),e.click_cost=xe(e.cost/e.productClickCountPv),e.memberDepName=e.memberDepId?De(ge.value,e.memberDepId):"-",e.click_rate="-"===xe(e.productClickCountPv/e.exposureCount*100)?"-":`${xe(e.productClickCountPv/e.exposureCount*100)}%`,e.qan_cost=xe(e.cost/e.exposureCount*1e3),e.zh_cost=xe(e.cost/e.productOrderCount),e.zh_rate="-"===xe(e.productOrderCount/e.productClickCountPv*100)?"-":`${xe(e.productOrderCount/e.productClickCountPv*100)}%`,e.shutdownSwitch=0!==e.shutdownStatus})),_e.value=a.grid||[],ve.current=e.pageIndex,ve.pageIndex=e.pageIndex,ve.total=a.total}catch(a){}finally{se(!1)}},je=e=>{pe.pageIndex=e.current,pe.current=e.current,pe.pageSize=e.pageSize,ve.pageIndex=e.current,ve.current=e.current,ve.pageSize=e.pageSize,Ie({...we.value,...pe})},Ke=e=>{e&&(we.value.startDate=e[0],we.value.endDate=e[1])},Me=()=>{je({current:1,pageSize:ve.pageSize})},ze=async(e,a)=>{2===e?(de.value="修改计划包",ue.value.packageId=a.packageId,ue.value.name=a.packageName):(de.value="新增计划包",ue.value.name=null),ue.value.type=e,ie.value=!0},He=async e=>{var a;await(null==(a=ce.value)?void 0:a.validate())?e(!1):(1===ue.value.type?(await B({name:ue.value.name}),v.success({content:"添加计划包成功",duration:5e3}),await Me()):(await E({packageId:ue.value.packageId,name:ue.value.name}),v.success({content:"修改计划包成功",duration:5e3}),await Me()),ue.value.name=null,window.setTimeout((()=>{e()}),300))},Oe=W(),Te=t([]);localStorage.getItem("package-disPlayColumns")?Te.value=JSON.parse(localStorage.getItem("package-disPlayColumns")):ye.value.forEach((e=>{Te.value.push(e.colKey)}));const Ve=async e=>{localStorage.setItem("package-disPlayColumns",JSON.stringify(e))},Ne=async e=>{e?(we.value.orderKey=e.sortBy,we.value.orderSort=e.descending?"DESC":"ASC"):we.value.orderSort=null,Me()},Pe=t([]);Pe.value=[o().add(-1,"month"),o()];return(async()=>{const{data:e}=await $({pageIndex:1,pageSize:200,sphType:1});Ce.value=e.grid})(),(async()=>{const{data:e}=await q({pageIndex:1,pageSize:200});Ye.value=e.grid})(),(async()=>{const{data:e}=await G({pageIndex:1,pageSize:200});ke.value=e.grid})(),(async e=>{const{data:a}=await L(e);return a.grid?ge.value=R(a.grid):ge.value=[],new Promise((e=>{e(!0)}))})({pageIndex:1,pageSize:150}).then((e=>{Ie({...we.value})})),a({fetchData:Ie}),(e,a)=>{const t=r("Breadcrumb"),l=y,P=h,U=b,B=x,E=N,q=w,G=_,L=C,R=Y,W=k,$=D,se=S,pe=I,xe=j,Ce=r("icon-plus"),Ye=r("icon-settings"),ke=K,De=M,Ie=z,Ue=r("t-table"),Ae=H;return n(),s("div",Z,[i("div",ee,[d(t,{items:["投流管理","计划包"]}),ae,d(se,null,{default:u((()=>[d(xe,{class:"general-card-upai",style:{width:"100%"}},{default:u((()=>[d(se,null,{default:u((()=>[d(U,{flex:1},{default:u((()=>[d(pe,{model:we.value,"auto-label-width":"","label-align":"left"},{default:u((()=>[d(se,{gutter:16},{default:u((()=>[d(U,{span:8},{default:u((()=>[d(P,{field:"name"},{label:u((()=>[te])),default:u((()=>[d(l,{modelValue:we.value.name,"onUpdate:modelValue":a[0]||(a[0]=e=>we.value.name=e),placeholder:"请输入计划包名称","allow-clear":"",onPressEnter:Me},null,8,["modelValue"])])),_:1})])),_:1}),d(U,{span:8},{default:u((()=>[d(P,{field:"sphId"},{label:u((()=>[le])),default:u((()=>[d(B,{modelValue:we.value.memberDepId,"onUpdate:modelValue":a[1]||(a[1]=e=>we.value.memberDepId=e),options:ge.value,"check-strictly":"","allow-clear":"","field-names":{value:"memberDepId",label:"memberDepName"},placeholder:"请选择所属部门",onClear:Se},null,8,["modelValue","options"])])),_:1})])),_:1}),d(U,{span:8},{default:u((()=>[d(P,{field:"hotStatus"},{label:u((()=>[oe])),default:u((()=>[d(q,{modelValue:we.value.hotStatus,"onUpdate:modelValue":a[2]||(a[2]=e=>we.value.hotStatus=e),placeholder:"请选择加热状态"},{default:u((()=>[(n(!0),s(c,null,p(m(F)(m(J)),((e,a)=>(n(),V(E,{key:a,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),d(U,{span:10},{default:u((()=>[d(P,{field:"createdTime"},{label:u((()=>[re])),default:u((()=>[d(G,{modelValue:Pe.value,"onUpdate:modelValue":a[3]||(a[3]=e=>Pe.value=e),"show-time":"","default-value":[],style:{width:"100%"},shortcuts:T,"shortcuts-position":"left",onChange:Ke},null,8,["modelValue"])])),_:1})])),_:1}),d(U,{span:8}),d(U,{span:6}),d(U,{span:8},{default:u((()=>[d(P,{field:"number","hide-label":!0},{default:u((()=>[d($,{size:18},{default:u((()=>[d(L,{type:"primary",class:"searchBtn",onClick:Me},{default:u((()=>[f(" 筛选 ")])),_:1}),d(L,{type:"outline",class:"refreshBtn",onClick:a[4]||(a[4]=e=>Me())},{default:u((()=>[f(" 刷新 ")])),_:1}),d(W,{type:"primary"},{default:u((()=>[d(R,{href:"javascript:void(0)",onClick:a[5]||(a[5]=e=>(we.value=he(),void(Pe.value=[o().add(-1,"month"),o()])))},{default:u((()=>[f("重置筛选条件")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1})])),_:1})])),_:1}),d(xe,{class:"general-card-upai",style:{width:"100%","padding-bottom":"28px"}},{default:u((()=>[d(se,{justify:"space-between"},{default:u((()=>[d(U,{flex:"250px"},{default:u((()=>[d($,{size:18,style:{"margin-bottom":"10px"}},{default:u((()=>[d(L,{type:"primary",onClick:a[6]||(a[6]=e=>ze(1))},{icon:u((()=>[d(Ce)])),default:u((()=>[f(" 创建计划包 ")])),_:1})])),_:1})])),_:1}),d(U,{flex:"60px"},{default:u((()=>[d($,{size:18,style:{"margin-bottom":"10px"}},{default:u((()=>[d(L,{type:"primary",onClick:a[7]||(a[7]=e=>me.value=!0)},{icon:u((()=>[d(Ye)])),default:u((()=>[f(" 列表配置 ")])),_:1})])),_:1})])),_:1})])),_:1}),d(Ue,{columnControllerVisible:me.value,"onUpdate:columnControllerVisible":a[8]||(a[8]=e=>me.value=e),"row-key":"plantId",data:_e.value,columns:ye.value,loading:m(ne),"header-affixed-top":!0,"max-height":1e3,"column-controller":{placement:"top-right",fields:fe.value,dialogProps:{preventScrollThrough:!0},hideTriggerButton:!0},pagination:ve,bordered:!1,"table-layout":"fixed","default-display-columns":Te.value,"on-display-columns-change":Ve,onPageChange:je,onSortChange:Ne},{process:u((({row:e})=>[d(ke,{percent:Number(be(e.cost/e.estimatedWecoinAmount)),style:{width:"50%"}},null,8,["percent"])])),roi:u((({row:e})=>[f(g(be(e.productPlaceorderGmv/e.cost)),1)])),lr:u((({row:e})=>[f(g(be(e.productPlaceorderGmv-e.cost)),1)])),hotStatus:u((({row:e})=>[d(De,{color:X[e.hotStatus]},{default:u((()=>[f(g(m(J)[e.hotStatus]),1)])),_:2},1032,["color"])])),op:u((({row:e})=>[d(L,{type:"text",size:"small",onClick:a=>(e=>{Oe.push({name:"plantliveData",query:{packageId:e.packageId,packageCreaedAt:o(e.createdAt).unix()}})})(e)},{default:u((()=>[f(" 查看计划 ")])),_:2},1032,["onClick"]),d(L,{type:"text",size:"small",onClick:a=>ze(2,e)},{default:u((()=>[f(" 修改 ")])),_:2},1032,["onClick"]),d(Ie,{content:"确认是否删除此计划","ok-text":"确认",onOk:a=>(async e=>{const{data:a}=await A({packageId:e.packageId});a&&(v.success({content:"删除计划包成功",duration:5e3}),await Me())})(e)},{default:u((()=>[d(L,{type:"text",size:"small"},{default:u((()=>[f(" 删除 ")])),_:1})])),_:2},1032,["onOk"])])),_:1},8,["columnControllerVisible","data","columns","loading","column-controller","pagination","default-display-columns"])])),_:1})]),d(Ae,{visible:ie.value,"onUpdate:visible":a[10]||(a[10]=e=>ie.value=e),title:de.value,onCancel:a[11]||(a[11]=e=>ie.value=!1),onBeforeOk:He},{default:u((()=>[d(pe,{ref_key:"formGpRef",ref:ce,model:ue.value,"label-col-props":{span:6},"wrapper-col-props":{span:18}},{default:u((()=>[d(P,{field:"name",label:"计划包名称",rules:[{required:!0,message:"请填写计划包名称"}]},{default:u((()=>[d(l,{modelValue:ue.value.name,"onUpdate:modelValue":a[9]||(a[9]=e=>ue.value.name=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model"])])),_:1},8,["visible","title"]),d(Q,{ref_key:"exportList",ref:O},null,512)])}}}),[["__scopeId","data-v-4c63067c"]]);export{ne as default};
