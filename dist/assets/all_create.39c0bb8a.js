import{_ as e}from"./index.a302575e.js";/* empty css               *//* empty css              *//* empty css                *//* empty css               *//* empty css                *//* empty css                *//* empty css                *//* empty css               *//* empty css               *//* empty css              *//* empty css               *//* empty css              *//* empty css                *//* empty css                *//* empty css               *//* empty css              *//* empty css               *//* empty css                *//* empty css                *//* empty css                */import{d as a,f as l,aH as i,D as n,E as t,aK as u,H as d,aJ as o,aF as s,aO as r,aG as p,aM as v,aL as c,aP as m,G as f,b_ as g,bk as y,by as h,bm as b,bR as I,bq as _,c9 as x,bl as k,bv as w,bi as V,cA as j,cB as T,ch as N,ci as C,bu as D,ca as U,bz as A,c8 as z,c2 as S,bJ as P,bL as J,c3 as O,be as q,bQ as F,bG as R,c4 as B,c6 as G,b9 as E,ba as K,cd as L}from"./arco.0e1801a1.js";import{f as H}from"./vue.6618b53d.js";import{c as M,e as $,f as Q,h as W,i as X,s as Y,o as Z,E as ee,j as ae,k as le,l as ie}from"./sph-aide.33599de6.js";import"./chart.b4fe0742.js";const ne=e=>(E("data-v-678a5cc0"),e=e(),K(),e),te={class:"container"},ue=ne((()=>d("input",{id:"moliCors",type:"hidden"},null,-1))),de=ne((()=>d("p",null,"选择要创建发布素材的视频号",-1))),oe=ne((()=>d("p",null,"指的是同一篇视频上传审核多少份",-1))),se={key:0,style:{"font-size":"12px"}},re={style:{"font-size":"12px","min-width":"40px"}},pe=ne((()=>d("span",{style:{"font-size":"18px","font-weight":"500"}},"创建数量： ",-1))),ve={key:1},ce=e(a({__name:"all_create",setup(e){const a=H();l({sequence:"",exportId:"",engineInfo:{groupId:null,packageId:null,sphId:null,ruleId:"",taskNum:1,taskArr:[],yjl:100,videoUrl:"",videoInfo:{shoppingcartJumpinfo:{}},authorInfo:{}},feedPromotionOrderInfo:{promotionTarget:6,promotionType:1,estimatedWecoinAmount:"1000",suggest:{gender:[],ageRange:[],cityIds:[],interestTag:[],roomInfo:{roomId:[]},similarUsernameList:[]},duration:"86400",pricingMethod:0,internalInfo:{isInternal:!1}},voucherIds:[],deviceInfo:{deviceTypeId:1},baseReq:{featureFlag:26}});const E=l({engineInfo:{sphAideId:null,sphId:null,createNum:1,videoPath:null,coverFrameUrl:null,videoDescriptionArr:null,aideDescriptionId:null,videoDescriptionType:1,useTemp:0,publishType:1,publishTimer:null,publishTimerDate:null,createPlantJson:"{}",productCode:null}}),K=e=>g(e).isBefore(g()),ne=l([]),ce=l(""),me=l([]),fe=l(null),ge=l(!1),ye=l([]),he=l(!1),be=l(!1);l("");const Ie=l(),_e=l();l();const xe=l([]),ke=l(null),we=l(""),Ve=l(!1),je=l("");l({value:"",key:""});const Te=l([{value:"",key:1}]),Ne=l(!1),Ce=l(!1),De=l(!1),Ue=l(!1),Ae=l(""),ze=async()=>{E.value.engineInfo.sphAideId?(Ge(),be.value=!0):y.warning({content:"请先选择发布号",duration:3e3})},Se=()=>{window.open(`${je.value}?time=${g().unix()}`)},Pe=async e=>{const{data:a}=await M({pageIndex:1,pageSize:200,name:e});xe.value=a.grid||[]};Pe("");const Je=l(!1),Oe=l("新建分组"),qe=l({name:null,type:1}),Fe=l(),Re=async e=>{Oe.value=1===e?"新增模版":2===e?"保存模版":"删除模板",qe.value.name=we.value,qe.value.type=e,Je.value=!0},Be=async e=>{var a;if(await(null==(a=Fe.value)?void 0:a.validate()))e(!1);else{if(1===qe.value.type)await $({tempId:ke.value,tempName:qe.value.name,descriptionArr:JSON.stringify(Te.value)}),y.success("新增成功");else if(2===qe.value.type)null===ke.value?await $({tempId:ke.value,tempName:qe.value.name,descriptionArr:JSON.stringify(Te.value)}):await Q({tempId:ke.value,tempName:qe.value.name,descriptionArr:JSON.stringify(Te.value)}),y.success("修改成功");else if(3===qe.value.type){if(null===ke.value)return void y.info("请选择要删除的模板");await W({tempId:ke.value}),ke.value=null,y.success("删除成功")}Pe(""),window.setTimeout((()=>{e()}),300)}},Ge=async()=>{he.value=!0;const e=await X({sphId:E.value.engineInfo.sphAideId});he.value=!1,e.data.data.products.forEach(((e,a)=>{e.key=a+1})),ye.value=e.data.data.products},Ee=(e,a)=>{Ie.value=[],Ie.value.push(e.key),ce.value=e.title,E.value.engineInfo.productCode=e.productId},Ke=e=>{const{onProgress:a,onError:l,onSuccess:i,fileItem:n,name:t}=e;i("")},Le=(e,a)=>{_e.value=a},He=async e=>{const{data:a}=await Y({pageIndex:1,pageSize:100,sphName:e});ne.value=a.grid,je.value=a.extUrl},Me=()=>{me.value=[],fe.value=""},$e=async()=>{if(Ve.value=!0,await Qe(),!ge.value)return y.error("请安装或启动插件"),void(Ve.value=!1);try{const{data:e}=await Z({});if([...me.value,...e.filePaths].length>10)return me.value=[...me.value,...e.filePaths].slice(0,10),fe.value=me.value.join("\n"),Ve.value=!1,E.value.engineInfo.videoPath=me.value,void y.info("最多上传10个视频");e.filePaths&&(E.value.engineInfo.videoPath=me.value,me.value=[...me.value,...e.filePaths],fe.value=me.value.join("\n"))}catch(e){}Ve.value=!1},Qe=async()=>{try{await ee({}),ge.value=!0}catch(e){ge.value=!1}},We=async()=>{await Qe(),setTimeout((()=>{We()}),1e3)},Xe=()=>{a.push({name:"videoTaskGrid"})};(()=>{if(localStorage.getItem("videoTask")){const e=JSON.parse(localStorage.getItem("videoTask"));Number(e.engineInfo.createNum)>5&&(e.engineInfo.createNum=5),E.value=e,e.engineInfo.videoDescriptionArr&&(Te.value=JSON.parse(e.engineInfo.videoDescriptionArr)),me.value=e.engineInfo.videoPath,fe.value=e.engineInfo.videoPath.join("/n")}})();return He(null),We(),(e,l)=>{const H=i("Breadcrumb"),M=h,$=i("icon-info-circle-fill"),Q=b,W=i("icon-question-circle-fill"),X=I,Y=_,Z=L,ee=x,je=k,We=w,Ye=V,Ze=j,ea=T,aa=N,la=C,ia=D,na=i("icon-plus"),ta=i("icon-minus"),ua=U,da=A,oa=z,sa=S,ra=P,pa=J,va=O,ca=q,ma=F,fa=R,ga=B,ya=G;return n(),t("div",te,[u(H,{items:["投流管理","批量发布视频"]}),ue,d("div",{style:f({boxSizing:"border-box",width:"100%",padding:"10px 20px 0 20px",backgroundColor:"var(--color-fill-2)"})},[u(va,{gutter:24,style:{marginBottom:"-5px"}},{default:o((()=>[u(sa,{span:18},{default:o((()=>[ge.value?p("",!0):(n(),s(Q,{key:0,type:"error"},{icon:o((()=>[u($)])),default:o((()=>[r("使用批量发布视频功能，请"),u(M,{style:{"font-size":"14px !important",padding:"0"},onClick:Se},{default:o((()=>[r("下载魔力智投插件")])),_:1})])),_:1})),u(oa,{title:"发布视频信息",bordered:!1,style:{width:"100%"}},{default:o((()=>[u(da,{ref:"formJcRef","auto-label-width":"",model:E.value.engineInfo,style:{width:"520px"}},{default:o((()=>[u(We,{field:"sphAideId",label:"发布号",rules:[{required:!0,message:"请选择发布号"}],"validate-trigger":["change","input"]},{label:o((()=>[u(Y,{size:3},{default:o((()=>[r(" 发布号 "),u(X,{title:""},{content:o((()=>[de])),default:o((()=>[u(W)])),_:1})])),_:1})])),default:o((()=>[u(ee,{modelValue:E.value.engineInfo.sphAideId,"onUpdate:modelValue":l[0]||(l[0]=e=>E.value.engineInfo.sphAideId=e),placeholder:"可输入视频号名称或备注名进行搜索","allow-search":{retainInputValue:!0},"allow-clear":"",style:{"margin-right":"10px"},onSearch:He},{default:o((()=>[(n(!0),t(v,null,c(ne.value,((e,a)=>(n(),s(Z,{key:a,label:e.sphName,value:e.sphId,onClick:a=>(async e=>{const{data:a}=await ie({sphId:e.sphId});1===a.data.hasProducts&&(Ne.value=!0,Ge())})(e)},null,8,["label","value","onClick"])))),128))])),_:1},8,["modelValue"]),u(je,{type:"primary",size:"small",onClick:l[1]||(l[1]=e=>{a.push({name:"sphList",query:{key:2}})})},{default:o((()=>[r(" 登录发布号 ")])),_:1})])),_:1}),u(We,{field:"createNum",label:"创建数量",rules:[{required:!0,message:"请填写创建数量"}],"validate-trigger":["change","input"]},{label:o((()=>[u(Y,{size:3},{default:o((()=>[r(" 创建数量 "),u(X,{title:""},{content:o((()=>[oe])),default:o((()=>[u(W)])),_:1})])),_:1})])),default:o((()=>[u(Ye,{modelValue:E.value.engineInfo.createNum,"onUpdate:modelValue":l[2]||(l[2]=e=>E.value.engineInfo.createNum=e),placeholder:"请填写创建数量",min:1,max:5},null,8,["modelValue"])])),_:1}),u(We,{field:"videoArr",label:"加热视频",rules:[{required:!0,message:"请上传加热视频"}],"validate-trigger":["input"]},{default:o((()=>[u(Y,null,{default:o((()=>[u(Ze,{modelValue:fe.value,"onUpdate:modelValue":l[3]||(l[3]=e=>fe.value=e),style:{"min-height":"70px","min-width":"440px"},"auto-size":"","allow-clear":"",placeholder:"点击上传素材视频",readonly:"",onClear:Me},null,8,["modelValue"]),u(Y,{direction:"vertical",style:{"min-width":"100px","text-align":"center"}},{default:o((()=>[d("div",null,[u(je,{type:"primary",disabled:Ve.value,onClick:$e},{default:o((()=>[r("上传视频")])),_:1},8,["disabled"])]),me.value.length>0?(n(),t("span",se,"已选择"+m(me.value.length)+"个视频",1)):p("",!0)])),_:1})])),_:1})])),_:1}),u(We,{field:"taskNum",label:"视频封面"},{default:o((()=>[u(ea,{"list-type":"picture-card",action:"/",tip:"自动生成封面",limit:1,"image-preview":"","custom-request":Ke,onChange:Le})])),_:1}),u(We,{field:"objDescDescriptionArr",label:"视频描述"},{default:o((()=>[u(Y,{direction:"vertical",size:0},{default:o((()=>[u(Y,null,{default:o((()=>[u(la,{modelValue:E.value.engineInfo.useTemp,"onUpdate:modelValue":l[4]||(l[4]=e=>E.value.engineInfo.useTemp=e),disabled:Ce.value},{default:o((()=>[u(aa,{value:0},{default:o((()=>[r("不使用模版")])),_:1}),u(aa,{value:1},{default:o((()=>[r("使用模版")])),_:1})])),_:1},8,["modelValue","disabled"]),0===E.value.engineInfo.useTemp?(n(),s(je,{key:0,type:"primary",size:"mini",disabled:Ce.value,onClick:l[5]||(l[5]=e=>Re(1))},{default:o((()=>[r("新增模板")])),_:1},8,["disabled"])):p("",!0)])),_:1}),1===E.value.engineInfo.useTemp?(n(),s(Y,{key:0,style:{"margin-top":"10px"}},{default:o((()=>[u(ee,{modelValue:ke.value,"onUpdate:modelValue":l[6]||(l[6]=e=>ke.value=e),disabled:Ce.value,"allow-search":"",placeholder:"可输入模板进行搜索",clear:"",style:{"min-width":"180px"},onSearch:Pe},{default:o((()=>[(n(!0),t(v,null,c(xe.value,((e,a)=>(n(),s(Z,{key:a,style:{"min-width":"180px"},value:e.tempId,onClick:a=>{Te.value=JSON.parse(e.descriptionArr),we.value=e.tempName}},{default:o((()=>[r(m(e.tempName),1)])),_:2},1032,["value","onClick"])))),128))])),_:1},8,["modelValue","disabled"]),u(je,{type:"primary",disabled:Ce.value,size:"mini",onClick:l[7]||(l[7]=e=>Re(1))},{default:o((()=>[r("新增模板")])),_:1},8,["disabled"]),u(je,{type:"primary",disabled:Ce.value,size:"mini",onClick:l[8]||(l[8]=e=>Re(2))},{default:o((()=>[r("保存模板")])),_:1},8,["disabled"]),u(je,{type:"primary",disabled:Ce.value,status:"danger",size:"mini",onClick:l[9]||(l[9]=e=>Re(3))},{default:o((()=>[r("删除模板")])),_:1},8,["disabled"])])),_:1})):p("",!0),u(Y,{direction:"vertical",style:{"margin-top":"10px"}},{default:o((()=>[(n(!0),t(v,null,c(Te.value,((e,a)=>(n(),s(Y,{key:a,style:{"min-width":"460px"}},{default:o((()=>[d("span",re,"描述"+m(a+1)+":",1),u(ia,{"model-value":Te.value[a].value,"onUpdate:modelValue":e=>Te.value[a].value=e,placeholder:"请输入视频描述",style:{"min-width":"420px"},disabled:Ce.value},null,8,["model-value","onUpdate:modelValue","disabled"]),a+1===1?(n(),s(je,{key:0,type:"primary",shape:"circle",onClick:l[10]||(l[10]=e=>Te.value.push({key:Te.value.length+1,value:""}))},{icon:o((()=>[u(na)])),_:1})):p("",!0),a+1>1?(n(),s(je,{key:1,type:"primary",status:"danger",shape:"circle",onClick:e=>Te.value.splice(a,1)},{icon:o((()=>[u(ta)])),_:2},1032,["onClick"])):p("",!0)])),_:2},1024)))),128))])),_:1}),u(la,{modelValue:E.value.engineInfo.videoDescriptionType,"onUpdate:modelValue":l[11]||(l[11]=e=>E.value.engineInfo.videoDescriptionType=e),style:{"margin-top":"10px"},change:Ce.value=3===E.value.engineInfo.videoDescriptionType},{default:o((()=>[u(aa,{value:1},{default:o((()=>[r("循环使用描述")])),_:1}),u(aa,{value:2},{default:o((()=>[r("随机使用描述")])),_:1}),u(aa,{value:3},{default:o((()=>[r("使用视频名称作为描述")])),_:1})])),_:1},8,["modelValue","change"])])),_:1})])),_:1}),u(We,{label:"加热商品"},{default:o((()=>[u(ia,{modelValue:ce.value,"onUpdate:modelValue":l[12]||(l[12]=e=>ce.value=e),readonly:"",disabled:!Ne.value,placeholder:"选择商品",onClick:ze},null,8,["modelValue","disabled"])])),_:1}),u(We,{label:"发布时间"},{default:o((()=>[u(la,{modelValue:E.value.engineInfo.publishType,"onUpdate:modelValue":l[13]||(l[13]=e=>E.value.engineInfo.publishType=e)},{default:o((()=>[u(aa,{value:1},{default:o((()=>[r("立即发布")])),_:1}),u(aa,{value:2},{default:o((()=>[r("定时发布")])),_:1})])),_:1},8,["modelValue"]),2===E.value.engineInfo.publishType?(n(),s(ua,{key:0,modelValue:E.value.engineInfo.publishTimerDate,"onUpdate:modelValue":l[14]||(l[14]=e=>E.value.engineInfo.publishTimerDate=e),"show-time":"","disabled-date":K},null,8,["modelValue"])):p("",!0)])),_:1}),u(We,{label:"是否加热"},{default:o((()=>[u(la,{"default-value":1,disabled:!0},{default:o((()=>[u(aa,{value:1},{default:o((()=>[r("仅发布视频")])),_:1}),u(aa,{value:2},{default:o((()=>[r("发布视频并加热")])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1})])),_:1}),u(sa,{span:6},{default:o((()=>[u(oa,{title:"确认信息",bordered:!1,style:{width:"100%"}},{default:o((()=>[u(pa,{style:{"margin-bottom":"30px"}},{default:o((()=>[u(ra,null,{default:o((()=>[pe,d("span",null,m(E.value.engineInfo.createNum)+"个",1)])),_:1})])),_:1}),u(je,{type:"primary",shape:"round",size:"large",long:"",disabled:Ue.value,onClick:l[15]||(l[15]=e=>(async()=>{if(await Qe(),!ge.value)return void y.warning("请安装或启动插件");if(!E.value.engineInfo.sphAideId)return void y.warning({content:"请先选择发布号",duration:3e3});if(0===me.value.length)return void y.warning("请上传视频文件");Ue.value=!0,E.value.engineInfo.publishTimerDate&&(E.value.engineInfo.publishTimer=g(E.value.engineInfo.publishTimerDate).unix()),E.value.engineInfo.videoDescriptionArr=JSON.stringify(Te.value),E.value.engineInfo.aideDescriptionId=ke.value;const{data:e}=await ae({...E.value.engineInfo});if(localStorage.setItem("videoTask",JSON.stringify(E.value)),_e.value){const a=new FormData;a.append("imagesFile",_e.value.file),a.append("uploadData",e.taskInfo),le(a)}else le({uploadData:e.taskInfo});De.value=!0,Ae.value="创建批量发布视频任务成功，您可以前往任务列表查看任务详情",Ue.value=!1})())},{default:o((()=>[r("创建任务 ")])),_:1},8,["disabled"])])),_:1})])),_:1})])),_:1})],4),u(ca,{visible:Je.value,"onUpdate:visible":l[17]||(l[17]=e=>Je.value=e),title:Oe.value,onCancel:l[18]||(l[18]=e=>Je.value=!1),onBeforeOk:Be},{default:o((()=>[u(da,{ref_key:"formGpRef",ref:Fe,model:qe.value,"label-col-props":{span:6},"wrapper-col-props":{span:18}},{default:o((()=>[1===qe.value.type||2===qe.value.type?(n(),s(We,{key:0,field:"name",label:"模板名称",rules:[{required:!0,message:"请填写模板名称"}]},{default:o((()=>[u(ia,{modelValue:qe.value.name,"onUpdate:modelValue":l[16]||(l[16]=e=>qe.value.name=e)},null,8,["modelValue"])])),_:1})):p("",!0),3===qe.value.type?(n(),t("span",ve," 您确定删除 "+m(qe.value.name)+" 模板吗 ",1)):p("",!0)])),_:1},8,["model"])])),_:1},8,["visible","title"]),u(ca,{visible:De.value,"onUpdate:visible":l[19]||(l[19]=e=>De.value=e),width:"420px",title:"提示",onOk:Xe},{default:o((()=>[d("div",null,m(Ae.value),1)])),_:1},8,["visible"]),u(ca,{visible:be.value,"onUpdate:visible":l[21]||(l[21]=e=>be.value=e),"mask-closable":!1,"ok-text":"添加",width:"1000px",title:"选择商品"},{default:o((()=>[u(ya,{selectedKeys:Ie.value,"onUpdate:selectedKeys":l[20]||(l[20]=e=>Ie.value=e),bordered:!1,pagination:!0,hoverable:!0,stripe:!1,loading:he.value,data:ye.value,"row-selection":{type:"radio"},onRowClick:Ee},{columns:o((()=>[u(ga,{title:"商品信息",align:"left"},{cell:o((({record:e})=>[u(Y,{size:12},{default:o((()=>[u(ma,{width:"70",src:e.imgUrls[0]},null,8,["src"]),u(Y,{direction:"vertical",fill:""},{default:o((()=>[u(fa,null,{default:o((()=>[r(" 商品名称 "+m(e.title),1)])),_:2},1024),u(fa,{disabled:""},{default:o((()=>[r(" ID: "+m(e.productId),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)])),_:1}),u(ga,{title:"商品来源",align:"center"},{cell:o((({record:e})=>[r(m(e.platformName),1)])),_:1}),u(ga,{title:"价格",align:"center"},{cell:o((({record:e})=>[r(m((e.sellingPrice/100).toFixed(2)),1)])),_:1}),u(ga,{title:"库存",align:"center"},{cell:o((({record:e})=>[r(m(e.stock),1)])),_:1})])),_:1},8,["selectedKeys","loading","data"])])),_:1},8,["visible"])])}}}),[["__scopeId","data-v-678a5cc0"]]);export{ce as default};
