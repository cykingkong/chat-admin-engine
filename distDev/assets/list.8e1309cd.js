import{d as Me,r as d,c as ze,w as de,i as Te,j as r,o as v,a as y,n as a,m as t,aK as Ue,M as x,F as q,k as j,q as h,e as p,t as k,u as ce,a8 as qe,l as D,s as je,B as Le,p as Ye,b as Oe,_ as Pe}from"./index.f3be9d6e.js";import{u as $e}from"./loading.b87f2d78.js";import{g as b}from"./event.471a062e.js";import{_ as N}from"./lodash.5369d405.js";import{g as Ge,b as ie,a as He,c as Je,d as Qe,i as me,u as We}from"./listMethods.f4d254e7.js";const L=A=>(Ye("data-v-f95b5300"),A=A(),Oe(),A),Xe={class:"content"},Ze={style:{"white-space":"nowrap"}},el={class:"status"},ll=L(()=>p("span",null,"\u72B6\u6001\uFF1A",-1)),al={key:0,"data-status-open":""},ul={key:1,"data-status-close":""},tl={class:"createTime"},ol=L(()=>p("span",null,"\u521B\u5EFA\u65F6\u95F4\uFF1A",-1)),nl={class:"createTime"},rl=L(()=>p("span",null,"\u5907\u6CE8\uFF1A",-1)),sl={name:"SearchTable"},dl=Me({...sl,setup(A){const V=d(0),Y=d(1),u=d((()=>({roleId:void 0,roleName:"",createdAt:"",memberRoleRemark:"",menuId:[]}))()),S=d([]),K=d([]),_=d([]),m=d([]),M=d(!1),I=d(!1),z=d(!1),F=d(!1),B=d(!1),O=d("\u6DFB\u52A0\u89D2\u8272"),P=()=>({roleName:"",roleData:0,memberRoleRemark:"",useStatus:1,type:1}),i=d(P()),ve=(e,l)=>{i.value.type=e,i.value=P(),_.value=[],O.value=e===1?"\u6DFB\u52A0\u89D2\u8272":"\u7F16\u8F91\u89D2\u8272",B.value=!0},fe=ze(()=>_.value);de(fe,(e,l)=>{console.log(e.length,m.value.length);const s=b(m.value);e.length===s.length?M.value=!0:e.length<s.length&&e.length>0?z.value=!0:(M.value=!1,z.value=!1)}),de(()=>u.value.menuId,(e,l)=>{if(e){const s=b(m.value);console.log(e),e.length===s.length?I.value=!0:e.length<s.length&&e.length>0?F.value=!0:(I.value=!1,F.value=!1)}});const pe=e=>{if(e){const l=b(m.value);_.value=l}else _.value=[]},_e=e=>{if(I.value=e,e){const l=b(m.value);u.value.menuId=l}else u.value.menuId=[]},{loading:ge,setLoading:$}=$e(!1),G=d([{value:0,label:"\u6240\u6709"},{value:1,label:"\u672C\u90E8\u95E8\u53CA\u4EE5\u4E0B\u6570\u636E\u6743\u9650 "},{value:2,label:"\u672C\u90E8\u95E8\u6570\u636E\u6743\u9650"},{value:3,label:"\u4EC5\u672C\u4EBA\u6570\u636E\u6743\u9650"}]),he=[{colKey:"memberNickname",title:"\u7528\u6237\u540D\u79F0",width:"200",align:"center"},{colKey:"memberAccount",title:"\u624B\u673A\u53F7",width:"200",align:"center"},{colKey:"memberDepName",title:"\u6240\u5C5E\u90E8\u95E8",width:"200",align:"center"}],H=(e,l="children")=>{for(let s=0;s<e.length;s++){const c=e[s];c&&c[l]&&(c[l].length===0?delete c[l]:H(c[l],l))}return e},J=()=>{Ge().then(e=>{console.log(e),e.grid&&(K.value=e.grid,V.value=e.grid[0].roleId,u.value=e.grid[0],ie(e.grid[0].roleId).then(l=>{console.log(l,"getRoleInfoByRoleId")}),Q(e.grid[0].roleId))})},be=e=>{ie(e).then(l=>{console.log(),l.menuId=b(l.grid),delete l.grid,console.log(l,"getRoleInfoByRoleId"),u.value=l})},Ie=e=>{console.log(e),Y.value=e},Q=e=>{He({roleId:e}).then(l=>{u.value.menuId=b(l.grid),ke()}),Je({roleId:e}).then(l=>{l.grid?S.value=l.grid.map(s=>({memberNickname:s.memberNickname||"-",memberAccount:s.memberAccount||"-",memberDepName:s.memberDepName||"-"})):S.value=[],u.value.memberTotal=l.total,E.total=l.total})},ye=e=>{u.value=N.find(K.value,["roleId",e]),Q(u.value.roleId)};J();function ke(){const e=b(m.value);u.value.menuId.length===e.length?I.value=!0:u.value.menuId.length<e.length&&u.value.menuId.length>0?F.value=!0:(I.value=!1,F.value=!1)}const De=async e=>{$(!0);try{const{data:l}=await Ue(e);if(l.grid){const c=H(l.grid).map(n=>({menuName:n.menuName,menuId:n.menuId,children:n.children||[],icon:n.menuIcon||""}));m.value=c.map(n=>{if(n.children.length>0&&n.menuId===32){const f=n.children.filter(T=>T.menuId!==34);n.children=f}return n}),console.log(m.value)}console.log(m.value)}catch(l){console.log(l)}finally{$(!1)}},Fe=e=>{console.log(e)},Be=e=>{console.log(u.value.menuId,"2")},C={current:1,pageIndex:1,pageSize:30,defaultPageSize:30,pageSizeOptions:[10,30,50,100],total:0,defaultCurrent:1,page:1},E=Te({...C});De({...C});const Ce=e=>{C.pageIndex=e.current,C.current=e.current,C.pageSize=e.pageSize,E.pageIndex=e.current,E.current=e.current,E.pageSize=e.pageSize},Ee=()=>{B.value=!1},W=d(),X=d(),Re=async()=>{var l;if(await((l=X.value)==null?void 0:l.validate()),console.log(u.value),u.value.menuId.length===0){x.info("\u8BF7\u4E3A\u89D2\u8272\u5206\u914D\u6743\u9650\uFF01");return}const e={roleId:u.value.roleId,roleName:u.value.roleName,roleData:u.value.roleData,useStatus:u.value.useStatus,memberRoleRemark:u.value.memberRoleRemark};We(e).then(s=>{const c={roleId:u.value.roleId,menuIdArr:u.value.menuId};u.value.menuId.forEach(n=>{m.value.forEach(f=>{N.find(f.children,["menuId",n])&&f.children.length>0&&!u.value.menuId.includes(N.find(f.children,["menuId",n]).parentId)&&u.value.menuId.push(N.find(f.children,["menuId",n]).parentId)})}),me(c).then(n=>{n.code===200&&(x.success("\u7F16\u8F91\u89D2\u8272\u6210\u529F"),be(u.value.roleId))})})},Ae=async e=>{var s;if(await((s=W.value)==null?void 0:s.validate())){e(!1);return}if(i.value.type===1){if(_.value.length===0){x.info("\u8BF7\u4E3A\u89D2\u8272\u5206\u914D\u6743\u9650\uFF01");return}Qe(i.value).then(c=>{if(console.log(c),c.code===200){const n={roleId:c.data.roleId,menuIdArr:[]};n.menuIdArr=_.value,me(n).then(f=>{f.code===200&&(x.success("\u6DFB\u52A0\u89D2\u8272\u6210\u529F"),B.value=!1,J())})}})}window.setTimeout(()=>{e()},300)};return(e,l)=>{const s=r("Breadcrumb"),c=r("icon-user"),n=r("a-space"),f=r("a-radio"),T=r("a-radio-group"),Z=r("a-scrollbar"),we=r("icon-plus"),ee=r("a-button"),le=r("a-card"),U=r("a-col"),xe=r("a-divider"),Ne=r("t-table"),ae=r("a-tab-pane"),w=r("a-input"),g=r("a-form-item"),ue=r("a-option"),te=r("a-select"),oe=r("a-checkbox"),ne=r("a-tree"),re=r("a-form"),se=r("a-row"),Ve=r("a-tabs"),Se=r("a-modal");return v(),y("div",Xe,[a(s,{items:["\u7CFB\u7EDF\u7BA1\u7406","\u89D2\u8272\u7BA1\u7406"]}),a(se,{gutter:24},{default:t(()=>[a(U,{span:5},{default:t(()=>[a(le,{style:{width:"100%","min-height":"537px"},class:"general-card",title:"\u7CFB\u7EDF\u89D2\u8272"},{default:t(()=>[a(Z,{style:{height:"71vh",overflow:"auto"}},{default:t(()=>[a(T,{modelValue:V.value,"onUpdate:modelValue":l[0]||(l[0]=o=>V.value=o),style:{width:"100%"},direction:"vertical",cols:1,"row-gap":24,onChange:l[1]||(l[1]=o=>ye(o))},{default:t(()=>[(v(!0),y(q,null,j(K.value,(o,R)=>(v(),D(f,{key:R,value:o.roleId},{radio:t(({checked:Ke})=>[a(n,{class:Le(["li",{checkLi:Ke}]),size:12},{default:t(()=>[a(c),p("span",Ze,k(o.roleName),1)]),_:2},1032,["class"])]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(ee,{type:"text",onClick:l[2]||(l[2]=o=>ve(1))},{default:t(()=>[a(n,null,{default:t(()=>[a(we),h("\u6DFB\u52A0\u89D2\u8272 ")]),_:1})]),_:1})]),_:1})]),_:1}),a(U,{span:19},{default:t(()=>[a(le,{style:{width:"100%"},class:"general-card",title:`${u.value.roleName}${u.value.memberTotal?"("+u.value.memberTotal+")":"-"}`||"-"},{default:t(()=>[a(n,{size:20},{default:t(()=>[p("div",el,[ll,p("span",null,[a(n,null,{default:t(()=>[u.value.useStatus===1?(v(),y("span",al)):(v(),y("span",ul)),h(" "+k(u.value.useStatus===1?"\u5DF2\u542F\u7528":"\u5DF2\u7981\u7528"),1)]),_:1})])]),p("div",tl,[ol,p("span",null,k(ce(qe)(u.value.createdAt).format("YYYY-MM-DD")),1)]),p("div",nl,[rl,p("span",null,k(u.value.memberRoleRemark||"-"),1)])]),_:1}),a(xe),a(Ve,{"active-key":Y.value,"lazy-load":"",style:{height:"68vh"},onChange:Ie},{default:t(()=>[(v(),D(ae,{key:1,title:"\u89D2\u8272\u6210\u5458"},{default:t(()=>[a(Ne,{"drag-sort":"col",data:S.value,"max-height":1e3,columns:he,loading:ce(ge),pagination:E,bordered:!1,onPageChange:Ce},null,8,["data","loading","pagination"])]),_:1})),(v(),D(ae,{key:2,title:"\u89D2\u8272\u6743\u9650"},{default:t(()=>[a(Z,{style:{height:"337px",overflow:"auto"}},{default:t(()=>[a(re,{ref_key:"formRefEdit",ref:X,style:{width:"500px"},model:u.value,"label-col-props":{span:6},"wrapper-col-props":{span:18}},{default:t(()=>[a(g,{field:"roleName",label:"\u89D2\u8272\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u89D2\u8272\u540D\u79F0"}]},{default:t(()=>[a(w,{modelValue:u.value.roleName,"onUpdate:modelValue":l[3]||(l[3]=o=>u.value.roleName=o),style:{width:"200px"},placeholder:"\u8BF7\u586B\u5199\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),a(g,{field:"memberRoleRemark",label:"\u89D2\u8272\u5907\u6CE8"},{default:t(()=>[a(w,{modelValue:u.value.memberRoleRemark,"onUpdate:modelValue":l[4]||(l[4]=o=>u.value.memberRoleRemark=o),style:{"{\n                          width":"200px"},placeholder:"\u8BF7\u586B\u5199\u89D2\u8272\u5907\u6CE8"},null,8,["modelValue"])]),_:1}),a(g,{field:"roleData",label:"\u6570\u636E\u6743\u9650",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6570\u636E\u6743\u9650"}]},{default:t(()=>[a(te,{modelValue:u.value.roleData,"onUpdate:modelValue":l[5]||(l[5]=o=>u.value.roleData=o),"allow-clear":"",placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u6743\u9650"},{default:t(()=>[(v(!0),y(q,null,j(G.value,(o,R)=>(v(),D(ue,{key:R,value:o.value},{default:t(()=>[h(k(o.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{field:"",label:"\u6743\u9650\u7BA1\u7406",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u83DC\u5355"}]},{default:t(()=>[a(n,{direction:"vertical"},{default:t(()=>[a(oe,{"model-value":I.value,indeterminate:F.value,onChange:_e},{default:t(()=>[h("\u5168\u9009")]),_:1},8,["model-value","indeterminate"]),a(ne,{"checked-keys":u.value.menuId,"onUpdate:checkedKeys":l[6]||(l[6]=o=>u.value.menuId=o),checkable:!0,"field-names":{key:"menuId",title:"menuName",children:"children",icon:"menuIcon"},"only-check-leaf":!0,"check-strictly":!1,"default-expand-all":!1,"checked-strategy":"all",data:m.value,onCheck:Be},null,8,["checked-keys","data"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1}),a(se,{justify:"center"},{default:t(()=>[a(U,{flex:"60px"},{default:t(()=>[a(ee,{type:"primary",onClick:Re},{default:t(()=>[h("\u7F16\u8F91")]),_:1})]),_:1})]),_:1})]),_:1}))]),_:1},8,["active-key"])]),_:1},8,["title"])]),_:1})]),_:1}),a(Se,{visible:B.value,"onUpdate:visible":l[11]||(l[11]=o=>B.value=o),title:O.value,width:i.value.type===1?"40%":"70%",onCancel:Ee,onBeforeOk:Ae},{default:t(()=>[a(re,{ref_key:"formRef",ref:W,model:i.value,"label-col-props":{span:6},"wrapper-col-props":{span:18}},{default:t(()=>[a(g,{field:"roleName",label:"\u89D2\u8272\u540D\u79F0",rules:[{required:!0,message:"\u8BF7\u586B\u5199\u89D2\u8272\u540D\u79F0"}]},{default:t(()=>[a(w,{modelValue:i.value.roleName,"onUpdate:modelValue":l[7]||(l[7]=o=>i.value.roleName=o),placeholder:"\u8BF7\u586B\u5199\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),a(g,{field:"memberRoleRemark",label:"\u89D2\u8272\u5907\u6CE8"},{default:t(()=>[a(w,{modelValue:i.value.memberRoleRemark,"onUpdate:modelValue":l[8]||(l[8]=o=>i.value.memberRoleRemark=o),placeholder:"\u8BF7\u586B\u5199\u89D2\u8272\u5907\u6CE8"},null,8,["modelValue"])]),_:1}),i.value.type!=3?(v(),D(g,{key:0,field:"roleData",label:"\u6570\u636E\u6743\u9650",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u6570\u636E\u6743\u9650"}]},{default:t(()=>[a(te,{modelValue:i.value.roleData,"onUpdate:modelValue":l[9]||(l[9]=o=>i.value.roleData=o),"allow-clear":"",placeholder:"\u8BF7\u9009\u62E9\u6570\u636E\u6743\u9650"},{default:t(()=>[(v(!0),y(q,null,j(G.value,(o,R)=>(v(),D(ue,{key:R,value:o.value},{default:t(()=>[h(k(o.label),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])]),_:1})):je("",!0),a(g,{field:"",label:"\u6743\u9650\u7BA1\u7406",rules:[{required:!0,message:"\u8BF7\u9009\u62E9\u83DC\u5355"}]},{default:t(()=>[a(n,{direction:"vertical"},{default:t(()=>[a(oe,{"model-value":M.value,indeterminate:z.value,onChange:pe},{default:t(()=>[h("\u5168\u9009")]),_:1},8,["model-value","indeterminate"]),a(ne,{"checked-keys":_.value,"onUpdate:checkedKeys":l[10]||(l[10]=o=>_.value=o),checkable:!0,"field-names":{key:"menuId",title:"menuName",children:"children",icon:"menuIcon"},"only-check-leaf":!0,"check-strictly":!1,"default-expand-all":!1,"checked-strategy":"all",data:m.value,onCheck:Fe},null,8,["checked-keys","data"])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1},8,["visible","title","width"])])}}});const gl=Pe(dl,[["__scopeId","data-v-f95b5300"]]);export{gl as default};
